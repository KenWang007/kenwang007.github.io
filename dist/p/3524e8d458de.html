<!DOCTYPE html>
<html lang="zh-CN" class="page-article">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="å¦‚ä½•ä½¿ç”¨HybridCacheæ¥è§£å†³ç¼“å­˜é—®é¢˜ - å…³é”®è¯: HybridCacheæ¥è§£å†³ç¼“å­˜é—®é¢˜, HybridCache, å¦‚ä½•ä½¿ç”¨">
    <meta name="keywords" content="HybridCacheæ¥è§£å†³ç¼“å­˜é—®é¢˜, HybridCache, å¦‚ä½•ä½¿ç”¨, æ¥è§£å†³ç¼“å­˜é—®é¢˜">
    <meta name="author" content="Ken Wang">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://kenwang007.github.io/dist/p/3524e8d458de.html">
    <meta property="og:title" content="å¦‚ä½•ä½¿ç”¨HybridCacheæ¥è§£å†³ç¼“å­˜é—®é¢˜ - Kençš„çŸ¥è¯†åº“">
    <meta property="og:description" content="å¦‚ä½•ä½¿ç”¨HybridCacheæ¥è§£å†³ç¼“å­˜é—®é¢˜ - å…³é”®è¯: HybridCacheæ¥è§£å†³ç¼“å­˜é—®é¢˜, HybridCache, å¦‚ä½•ä½¿ç”¨">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary">
    <meta property="twitter:url" content="https://kenwang007.github.io/dist/p/3524e8d458de.html">
    <meta property="twitter:title" content="å¦‚ä½•ä½¿ç”¨HybridCacheæ¥è§£å†³ç¼“å­˜é—®é¢˜ - Kençš„çŸ¥è¯†åº“">
    <meta property="twitter:description" content="å¦‚ä½•ä½¿ç”¨HybridCacheæ¥è§£å†³ç¼“å­˜é—®é¢˜ - å…³é”®è¯: HybridCacheæ¥è§£å†³ç¼“å­˜é—®é¢˜, HybridCache, å¦‚ä½•ä½¿ç”¨">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#6366f1">
    
    <title>å¦‚ä½•ä½¿ç”¨HybridCacheæ¥è§£å†³ç¼“å­˜é—®é¢˜ - Kençš„çŸ¥è¯†åº“</title>
    <link rel="stylesheet" href="/style.css?v=2.1.2">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22 fill=%22%236366f1%22>ğŸ“š</text></svg>">
    <link rel="canonical" href="https://kenwang007.github.io/dist/p/3524e8d458de.html">
    <link rel="manifest" href="/manifest.json">
    
    <!-- RSS Feed -->
    <link rel="alternate" type="application/rss+xml" title="Kençš„çŸ¥è¯†åº“ RSS Feed" href="/rss.xml">
    
    <!-- Breadcrumb Navigation -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "é¦–é¡µ",
          "item": "https://kenwang007.github.io/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "å¦‚ä½•ä½¿ç”¨HybridCacheæ¥è§£å†³ç¼“å­˜é—®é¢˜",
          "item": "https://kenwang007.github.io/dist/p/3524e8d458de.html"
        }
      ]
    }
    </script>
    
    <!-- Article Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "å¦‚ä½•ä½¿ç”¨HybridCacheæ¥è§£å†³ç¼“å­˜é—®é¢˜",
      "description": "å¦‚ä½•ä½¿ç”¨HybridCacheæ¥è§£å†³ç¼“å­˜é—®é¢˜ - å…³é”®è¯: HybridCacheæ¥è§£å†³ç¼“å­˜é—®é¢˜, HybridCache, å¦‚ä½•ä½¿ç”¨",
      "author": {
        "@type": "Person",
        "name": "Ken Wang"
      },
      "datePublished": "2026-01-30T22:33:54.102154",
      "dateModified": "2026-01-30T22:33:54.102154",
      "inLanguage": "zh-CN"
    }
    </script>
</head>
<body>
    <!-- æ˜Ÿç©ºèƒŒæ™¯ -->
    <div class="stars"></div>
    <div class="stars2"></div>
    <div class="stars3"></div>

    <!-- é¡¶éƒ¨å›ºå®šå¯¼èˆª -->
    <header class="top-nav">
        <div class="nav-container">
            <div class="logo">
                <a href="/index.html">
                    <span class="logo-text">ğŸ“š Kençš„çŸ¥è¯†åº“</span>
                </a>
            </div>
            <nav class="main-nav">
                <ul id="nav-menu" class="nav-menu">
                    <!-- åŠ¨æ€ç”Ÿæˆçš„å¯¼èˆªèœå•é¡¹ -->
                </ul>
            </nav>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
        <!-- å·¦ä¾§å›ºå®šå…³é”®è¯ç´¢å¼• -->
        <aside class="keyword-sidebar">
            <div class="keyword-header">
                <h3>å…³é”®è¯ç´¢å¼•</h3>
            </div>
            <div class="keyword-list" id="keyword-list">
                <!-- åŠ¨æ€ç”Ÿæˆçš„å…³é”®è¯ -->
            </div>
        </aside>

        <!-- ä¸­é—´ä¸»å†…å®¹ -->
        <section class="content-area">
            <div class="content-wrapper">
                <article class="markdown-content">
                    
<h1
id="å¦‚ä½•ä½¿ç”¨hybridcacheæ¥è§£å†³ç¼“å­˜é—®é¢˜">å¦‚ä½•ä½¿ç”¨HybridCacheæ¥è§£å†³ç¼“å­˜é—®é¢˜</h1>
<p>åœ¨ç°ä»£åº”ç”¨ç¨‹åºå¼€å‘ä¸­ï¼Œç¼“å­˜æ˜¯æå‡æ€§èƒ½çš„å…³é”®æŠ€æœ¯ã€‚.NET 9 å¼•å…¥äº†
<strong>HybridCache</strong>
æ¡†æ¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ–°çš„ç¼“å­˜æ¨¡å‹ï¼Œè®¾è®¡ç”¨äºå°è£…æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ï¼Œç®€åŒ–äº†ç¼“å­˜æ“ä½œå¹¶æä¾›äº†æ ‡ç­¾åˆ é™¤å’Œçº¦æŸé€‰é¡¹ã€‚</p>
<h2
id="ä¸€hybridcacheæ¡†æ¶çš„å®ç°åŸç†ä¸æ ¸å¿ƒåŠŸèƒ½">ä¸€ã€HybridCacheæ¡†æ¶çš„å®ç°åŸç†ä¸æ ¸å¿ƒåŠŸèƒ½</h2>
<h3 id="å®ç°åŸç†">1.1 å®ç°åŸç†</h3>
<p>HybridCache
æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå…¶é»˜è®¤å®ç°å¯å¤„ç†ä¿å­˜åˆ°ç¼“å­˜å’Œä»ç¼“å­˜ä¸­æ£€ç´¢çš„å¤§å¤šæ•°æ–¹é¢ã€‚å®ƒè®¾è®¡ç”¨äºå°è£…æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ï¼Œä½¿ç”¨è€…æ— éœ€æ‹…å¿ƒé€‰æ‹©ç¼“å­˜ç±»å‹ã€‚</p>
<p>æ ¹æ® Microsoft å®˜æ–¹æ–‡æ¡£ï¼ŒHybridCache å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>ç»Ÿä¸€API</strong>ï¼šä¸ºè¿›ç¨‹å†…å’Œè¿›ç¨‹å¤–ç¼“å­˜æä¾›ç»Ÿä¸€çš„API</li>
<li><strong>è‡ªåŠ¨å¤„ç†</strong>ï¼šè‡ªåŠ¨å¤„ç†ç¼“å­˜åŒæ­¥ã€è¿‡æœŸã€åºåˆ—åŒ–ç­‰å¤æ‚é€»è¾‘</li>
<li><strong>çµæ´»æ€§</strong>ï¼šæ”¯æŒå¤šç§ç¼“å­˜åç«¯ï¼ˆå†…å­˜ã€Redisã€SQL
Serverç­‰ï¼‰</li>
</ul>
<h3 id="æ ¸å¿ƒç»„ä»¶">1.2 æ ¸å¿ƒç»„ä»¶</h3>
<p>HybridCache çš„å®ç°ä¾èµ–äºä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li><strong><code>HybridCache</code>
ç±»</strong>ï¼šæŠ½è±¡ç±»ï¼Œæä¾›ç¼“å­˜æ“ä½œçš„ä¸»è¦æ¥å£</li>
<li><strong><code>IDistributedCache</code></strong>ï¼šç”¨äºåˆ†å¸ƒå¼ç¼“å­˜ï¼ˆå¦‚
Redisã€SQL Server ç­‰ï¼‰ï¼Œæä¾›è·¨å®ä¾‹æ•°æ®å…±äº«</li>
<li><strong><code>ICacheSerializer</code></strong>ï¼šè´Ÿè´£å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œé»˜è®¤å®ç°ä¸º
<code>SystemTextJsonCacheSerializer</code></li>
</ul>
<h3 id="ä¸»è¦æ ¸å¿ƒåŠŸèƒ½">1.3 ä¸»è¦æ ¸å¿ƒåŠŸèƒ½</h3>
<p>æ ¹æ® Microsoft å®˜æ–¹æ–‡æ¡£ï¼ŒHybridCache å…·æœ‰å…¶ä»– API
æ²¡æœ‰çš„ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<h4 id="ç”¨äºè¿›ç¨‹å†…å’Œè¿›ç¨‹å¤–ç¼“å­˜çš„ç»Ÿä¸€-api">1.3.1
ç”¨äºè¿›ç¨‹å†…å’Œè¿›ç¨‹å¤–ç¼“å­˜çš„ç»Ÿä¸€ API</h4>
<ul>
<li><strong>ç»Ÿä¸€æ¥å£</strong>ï¼šæä¾›ç»Ÿä¸€çš„APIæ¥è®¿é—®ä¸åŒç±»å‹çš„ç¼“å­˜</li>
<li><strong>è‡ªåŠ¨é€‰æ‹©</strong>ï¼šæ ¹æ®é…ç½®è‡ªåŠ¨é€‰æ‹©ä½¿ç”¨æœ¬åœ°ç¼“å­˜è¿˜æ˜¯åˆ†å¸ƒå¼ç¼“å­˜</li>
<li><strong>é€æ˜åˆ‡æ¢</strong>ï¼šå¼€å‘è€…æ— éœ€å…³å¿ƒåº•å±‚ç¼“å­˜å®ç°</li>
</ul>
<h4 id="è‡ªåŠ¨åºåˆ—åŒ–ä¸ååºåˆ—åŒ–">1.3.2 è‡ªåŠ¨åºåˆ—åŒ–ä¸ååºåˆ—åŒ–</h4>
<ul>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šæ”¯æŒå¼ºç±»å‹ç¼“å­˜æ“ä½œï¼Œè‡ªåŠ¨å¤„ç†å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–</li>
<li><strong>é»˜è®¤åºåˆ—åŒ–å™¨</strong>ï¼šä½¿ç”¨ <code>System.Text.Json</code>
è¿›è¡Œåºåˆ—åŒ–</li>
<li><strong>è‡ªå®šä¹‰åºåˆ—åŒ–å™¨</strong>ï¼šæ”¯æŒå®ç°è‡ªå®šä¹‰çš„
<code>ICacheSerializer</code> æ¥å£</li>
</ul>
<h4 id="çµæ´»çš„è¿‡æœŸç­–ç•¥">1.3.3 çµæ´»çš„è¿‡æœŸç­–ç•¥</h4>
<ul>
<li><strong>ç»å¯¹è¿‡æœŸ</strong>ï¼šè®¾ç½®ç¼“å­˜é¡¹çš„å›ºå®šè¿‡æœŸæ—¶é—´</li>
<li><strong>æ»‘åŠ¨è¿‡æœŸ</strong>ï¼šåŸºäºè®¿é—®æ—¶é—´åŠ¨æ€è°ƒæ•´è¿‡æœŸæ—¶é—´</li>
<li><strong>æœ¬åœ°ç¼“å­˜è¿‡æœŸ</strong>ï¼šå¯ä»¥å•ç‹¬é…ç½®æœ¬åœ°ç¼“å­˜çš„è¿‡æœŸæ—¶é—´</li>
</ul>
<h4 id="æ ‡ç­¾æ”¯æŒ">1.3.4 æ ‡ç­¾æ”¯æŒ</h4>
<ul>
<li><strong>æ ‡ç­¾ç®¡ç†</strong>ï¼šæ”¯æŒä¸ºç¼“å­˜é¡¹æ·»åŠ æ ‡ç­¾</li>
<li><strong>æ‰¹é‡åˆ é™¤</strong>ï¼šå¯ä»¥æ ¹æ®æ ‡ç­¾æ‰¹é‡åˆ é™¤ç¼“å­˜é¡¹</li>
<li><strong>çº¦æŸé€‰é¡¹</strong>ï¼šæ”¯æŒçº¦æŸé€‰é¡¹æ¥æ§åˆ¶ç¼“å­˜è¡Œä¸º</li>
</ul>
<h2
id="äºŒæ¡†æ¶å¦‚ä½•è‡ªåŠ¨å¤„ç†å¤šçº§ç¼“å­˜é—®é¢˜">äºŒã€æ¡†æ¶å¦‚ä½•è‡ªåŠ¨å¤„ç†å¤šçº§ç¼“å­˜é—®é¢˜</h2>
<h3 id="å¤šçº§ç¼“å­˜çš„å·¥ä½œæµç¨‹">2.1 å¤šçº§ç¼“å­˜çš„å·¥ä½œæµç¨‹</h3>
<p>HybridCache
é€šè¿‡æ™ºèƒ½çš„ç¼“å­˜è¯»å–å’Œå†™å…¥ç­–ç•¥ï¼Œè‡ªåŠ¨å¤„ç†å¤šçº§ç¼“å­˜çš„åè°ƒé—®é¢˜ã€‚</p>
<h4 id="è¯»å–ç¼“å­˜æµç¨‹">2.1.1 è¯»å–ç¼“å­˜æµç¨‹</h4>
<p>æ ¹æ® Microsoft å®˜æ–¹æ–‡æ¡£ï¼ŒHybridCache çš„è¯»å–æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol type="1">
<li>é¦–å…ˆæ£€æŸ¥æœ¬åœ°ç¼“å­˜ï¼ˆè¿›ç¨‹å†…ç¼“å­˜ï¼‰</li>
<li>å¦‚æœæœ¬åœ°ç¼“å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›æ•°æ®</li>
<li>å¦‚æœæœ¬åœ°ç¼“å­˜æœªå‘½ä¸­ï¼Œæ£€æŸ¥åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆè¿›ç¨‹å¤–ç¼“å­˜ï¼‰</li>
<li>å¦‚æœåˆ†å¸ƒå¼ç¼“å­˜å‘½ä¸­ï¼Œå°†æ•°æ®å›å¡«åˆ°æœ¬åœ°ç¼“å­˜å¹¶è¿”å›</li>
<li>å¦‚æœä¸¤çº§ç¼“å­˜éƒ½æœªå‘½ä¸­ï¼Œè°ƒç”¨å·¥å‚æ–¹æ³•ä»æ•°æ®æºåŠ è½½æ•°æ®</li>
<li>å°†åŠ è½½çš„æ•°æ®åŒæ—¶å†™å…¥æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜</li>
</ol>
<h4 id="å†™å…¥ç¼“å­˜æµç¨‹">2.1.2 å†™å…¥ç¼“å­˜æµç¨‹</h4>
<p>å†™å…¥ç¼“å­˜çš„æµç¨‹ï¼š</p>
<ol type="1">
<li>å°†æ•°æ®å†™å…¥æœ¬åœ°ç¼“å­˜</li>
<li>å°†æ•°æ®åºåˆ—åŒ–åå†™å…¥åˆ†å¸ƒå¼ç¼“å­˜</li>
<li>ç¡®ä¿ä¸¤çº§ç¼“å­˜çš„æ•°æ®ä¸€è‡´æ€§</li>
</ol>
<h3 id="ç¼“å­˜ä¸€è‡´æ€§ä¿è¯">2.2 ç¼“å­˜ä¸€è‡´æ€§ä¿è¯</h3>
<p>HybridCache é€šè¿‡ä»¥ä¸‹æœºåˆ¶ä¿è¯å¤šçº§ç¼“å­˜çš„ä¸€è‡´æ€§ï¼š</p>
<h4 id="è‡ªåŠ¨åŒæ­¥">2.2.1 è‡ªåŠ¨åŒæ­¥</h4>
<ul>
<li>å½“æ•°æ®æ›´æ–°æ—¶ï¼Œè‡ªåŠ¨æ›´æ–°æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜</li>
<li>ç¡®ä¿æ‰€æœ‰å®ä¾‹éƒ½èƒ½è·å–åˆ°æœ€æ–°æ•°æ®</li>
<li>å‡å°‘æ‰‹åŠ¨ç®¡ç†ç¼“å­˜ä¸€è‡´æ€§çš„å¤æ‚æ€§</li>
</ul>
<h4 id="è¿‡æœŸç­–ç•¥åŒæ­¥">2.2.2 è¿‡æœŸç­–ç•¥åŒæ­¥</h4>
<ul>
<li>æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ä½¿ç”¨åè°ƒçš„è¿‡æœŸç­–ç•¥</li>
<li>é¿å…å› è¿‡æœŸæ—¶é—´ä¸ä¸€è‡´å¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜</li>
<li>æ”¯æŒä¸ºæœ¬åœ°ç¼“å­˜é…ç½®å•ç‹¬çš„è¿‡æœŸæ—¶é—´</li>
</ul>
<h3 id="å¹¶å‘æ§åˆ¶">2.3 å¹¶å‘æ§åˆ¶</h3>
<p>HybridCache ä½¿ç”¨å†…ç½®æœºåˆ¶å¤„ç†å¹¶å‘è®¿é—®ï¼š</p>
<h4 id="é˜²æ­¢ç¼“å­˜å‡»ç©¿">2.3.1 é˜²æ­¢ç¼“å­˜å‡»ç©¿</h4>
<ul>
<li>ä½¿ç”¨å†…éƒ¨é”æœºåˆ¶ï¼Œé¿å…å¤šä¸ªè¯·æ±‚åŒæ—¶è§¦å‘ç¼“å­˜æœªå‘½ä¸­</li>
<li>å½“å¤šä¸ªè¯·æ±‚åŒæ—¶è®¿é—®åŒä¸€ä¸ªæœªå‘½ä¸­çš„ç¼“å­˜é”®æ—¶ï¼Œåªæœ‰ä¸€ä¸ªè¯·æ±‚ä¼šä»æ•°æ®æºåŠ è½½æ•°æ®</li>
<li>å…¶ä»–è¯·æ±‚ç­‰å¾…æ•°æ®åŠ è½½å®Œæˆåï¼Œç›´æ¥ä»ç¼“å­˜è·å–</li>
</ul>
<h2
id="ä¸‰æ¡†æ¶å¦‚ä½•è§£å†³ç¼“å­˜çš„å¸¸è§é—®é¢˜">ä¸‰ã€æ¡†æ¶å¦‚ä½•è§£å†³ç¼“å­˜çš„å¸¸è§é—®é¢˜</h2>
<h3 id="ç¼“å­˜ç©¿é€cache-penetration">3.1 ç¼“å­˜ç©¿é€ï¼ˆCache
Penetrationï¼‰</h3>
<p><strong>é—®é¢˜æè¿°</strong>ï¼šå¤§é‡è¯·æ±‚æŸ¥è¯¢ä¸å­˜åœ¨çš„æ•°æ®ï¼Œå¯¼è‡´è¯·æ±‚ç›´æ¥ç©¿é€åˆ°æ•°æ®åº“ã€‚</p>
<p><strong>HybridCache çš„è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol type="1">
<li><strong>ç©ºå€¼ç¼“å­˜</strong>ï¼šå°†æŸ¥è¯¢ä¸ºç©ºçš„ç»“æœä¹Ÿç¼“å­˜èµ·æ¥ï¼Œè®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´</li>
<li><strong>æ ‡ç­¾ç®¡ç†</strong>ï¼šä½¿ç”¨æ ‡ç­¾æ¥ç®¡ç†ç›¸å…³ç¼“å­˜é¡¹ï¼Œä¾¿äºæ‰¹é‡æ¸…ç†</li>
</ol>
<div class="sourceCode" id="cb1"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ç©ºå€¼ç¼“å­˜ç¤ºä¾‹</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> async Task<span class="op">&lt;</span>Product<span class="op">&gt;</span> <span class="fu">GetProductAsync</span><span class="op">(</span><span class="dt">int</span> productId<span class="op">)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> await _cache<span class="op">.</span><span class="fu">GetOrCreateAsync</span><span class="op">(</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        $<span class="st">&quot;product:{productId}&quot;</span><span class="op">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        async token <span class="op">=&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> product <span class="op">=</span> await _dbContext<span class="op">.</span><span class="fu">Products</span><span class="op">.</span><span class="fu">FindAsync</span><span class="op">(</span>productId<span class="op">,</span> token<span class="op">);</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>            <span class="co">// å¦‚æœäº§å“ä¸å­˜åœ¨ï¼Œç¼“å­˜ç©ºå€¼ï¼Œè®¾ç½®è¾ƒçŸ­è¿‡æœŸæ—¶é—´</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>product <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> <span class="kw">null</span><span class="op">;</span> <span class="co">// HybridCache ä¼šç¼“å­˜ null å€¼</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> product<span class="op">;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        options <span class="op">=&gt;</span> options<span class="op">.</span><span class="fu">AbsoluteExpirationRelativeToNow</span> <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromMinutes</span><span class="op">(</span><span class="dv">5</span><span class="op">)</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="ç¼“å­˜å‡»ç©¿cache-breakdown">3.2 ç¼“å­˜å‡»ç©¿ï¼ˆCache Breakdownï¼‰</h3>
<p><strong>é—®é¢˜æè¿°</strong>ï¼šæŸä¸ªçƒ­ç‚¹ç¼“å­˜è¿‡æœŸæ—¶ï¼Œå¤§é‡è¯·æ±‚åŒæ—¶ç©¿é€åˆ°æ•°æ®åº“ã€‚</p>
<p><strong>HybridCache çš„è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol type="1">
<li><strong>å†…ç½®é”æœºåˆ¶</strong>ï¼šHybridCache
å†…éƒ¨å·²ç»å®ç°äº†äº’æ–¥é”æœºåˆ¶</li>
<li><strong>è‡ªåŠ¨å¹¶å‘æ§åˆ¶</strong>ï¼šå½“å¤šä¸ªè¯·æ±‚åŒæ—¶è®¿é—®æœªå‘½ä¸­çš„ç¼“å­˜æ—¶ï¼Œåªæœ‰ä¸€ä¸ªä¼šä»æ•°æ®åº“åŠ è½½æ•°æ®</li>
</ol>
<div class="sourceCode" id="cb2"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// HybridCache å†…éƒ¨å·²å®ç°äº’æ–¥é”é˜²æ­¢ç¼“å­˜å‡»ç©¿</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> async Task<span class="op">&lt;</span>Product<span class="op">&gt;</span> <span class="fu">GetHotProductAsync</span><span class="op">(</span><span class="dt">int</span> productId<span class="op">)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// HybridCache å†…éƒ¨å·²ç»å®ç°äº†äº’æ–¥é”æœºåˆ¶</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// å½“å¤šä¸ªè¯·æ±‚åŒæ—¶è®¿é—®æœªå‘½ä¸­çš„ç¼“å­˜æ—¶ï¼Œåªæœ‰ä¸€ä¸ªä¼šä»æ•°æ®åº“åŠ è½½æ•°æ®</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> await _cache<span class="op">.</span><span class="fu">GetOrCreateAsync</span><span class="op">(</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        $<span class="st">&quot;product:{productId}&quot;</span><span class="op">,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        async token <span class="op">=&gt;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>            <span class="co">// è¿™ä¸ªæ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> await _dbContext<span class="op">.</span><span class="fu">Products</span><span class="op">.</span><span class="fu">FindAsync</span><span class="op">(</span>productId<span class="op">,</span> token<span class="op">);</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">},</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        options <span class="op">=&gt;</span> options<span class="op">.</span><span class="fu">AbsoluteExpirationRelativeToNow</span> <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="ç¼“å­˜é›ªå´©cache-avalanche">3.3 ç¼“å­˜é›ªå´©ï¼ˆCache Avalancheï¼‰</h3>
<p><strong>é—®é¢˜æè¿°</strong>ï¼šå¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸï¼Œå¯¼è‡´æ‰€æœ‰è¯·æ±‚éƒ½ç©¿é€åˆ°æ•°æ®åº“ã€‚</p>
<p><strong>HybridCache çš„è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol type="1">
<li><strong>å¤šçº§ç¼“å­˜</strong>ï¼šå³ä½¿åˆ†å¸ƒå¼ç¼“å­˜å…¨éƒ¨è¿‡æœŸï¼Œæœ¬åœ°ç¼“å­˜ä»å¯æä¾›æœåŠ¡</li>
<li><strong>æ ‡ç­¾æ‰¹é‡åˆ é™¤</strong>ï¼šä½¿ç”¨æ ‡ç­¾æ¥æ‰¹é‡ç®¡ç†ç›¸å…³ç¼“å­˜é¡¹ï¼Œé¿å…å¤§é‡ç¼“å­˜åŒæ—¶è¿‡æœŸ</li>
</ol>
<div class="sourceCode" id="cb3"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ä½¿ç”¨æ ‡ç­¾æ‰¹é‡ç®¡ç†ç¼“å­˜</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>await _cache<span class="op">.</span><span class="fu">SetAsync</span><span class="op">(</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    $<span class="st">&quot;product:{product.Id}&quot;</span><span class="op">,</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    product<span class="op">,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    options <span class="op">=&gt;</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        options<span class="op">.</span><span class="fu">AbsoluteExpirationRelativeToNow</span> <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        options<span class="op">.</span><span class="fu">Tags</span> <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> $<span class="st">&quot;category:{product.CategoryId}&quot;</span> <span class="op">};</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">// æ ¹æ®æ ‡ç­¾æ‰¹é‡åˆ é™¤ç¼“å­˜</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>await _cache<span class="op">.</span><span class="fu">RemoveByTagAsync</span><span class="op">(</span>$<span class="st">&quot;category:{categoryId}&quot;</span><span class="op">);</span></span></code></pre></div>
<h3 id="ç¼“å­˜ä¸€è‡´æ€§cache-consistency">3.4 ç¼“å­˜ä¸€è‡´æ€§ï¼ˆCache
Consistencyï¼‰</h3>
<p><strong>é—®é¢˜æè¿°</strong>ï¼šå¤šå®ä¾‹éƒ¨ç½²æ—¶ï¼Œä¸åŒå®ä¾‹çš„ç¼“å­˜æ•°æ®ä¸ä¸€è‡´ã€‚</p>
<p><strong>HybridCache çš„è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol type="1">
<li><strong>è‡ªåŠ¨åŒæ­¥</strong>ï¼šæ›´æ–°æ•°æ®æ—¶ï¼Œè‡ªåŠ¨æ›´æ–°æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜</li>
<li><strong>æ ‡ç­¾ç®¡ç†</strong>ï¼šä½¿ç”¨æ ‡ç­¾æ¥ç®¡ç†ç›¸å…³ç¼“å­˜é¡¹ï¼Œä¾¿äºæ‰¹é‡æ›´æ–°</li>
</ol>
<div class="sourceCode" id="cb4"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// è‡ªåŠ¨åŒæ­¥ä¿è¯ä¸€è‡´æ€§</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> async Task <span class="fu">UpdateProductAsync</span><span class="op">(</span>Product product<span class="op">)</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// æ­¥éª¤1ï¼šæ›´æ–°æ•°æ®åº“</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    _dbContext<span class="op">.</span><span class="fu">Products</span><span class="op">.</span><span class="fu">Update</span><span class="op">(</span>product<span class="op">);</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    await _dbContext<span class="op">.</span><span class="fu">SaveChangesAsync</span><span class="op">();</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// æ­¥éª¤2ï¼šæ›´æ–°ç¼“å­˜ï¼ˆè‡ªåŠ¨åŒæ­¥åˆ°æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ï¼‰</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    await _cache<span class="op">.</span><span class="fu">SetAsync</span><span class="op">(</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        $<span class="st">&quot;product:{product.Id}&quot;</span><span class="op">,</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        product<span class="op">,</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        options <span class="op">=&gt;</span> options<span class="op">.</span><span class="fu">AbsoluteExpirationRelativeToNow</span> <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="ç¼“å­˜æ€§èƒ½é—®é¢˜">3.5 ç¼“å­˜æ€§èƒ½é—®é¢˜</h3>
<p><strong>é—®é¢˜æè¿°</strong>ï¼šç¼“å­˜æ“ä½œçš„æ€§èƒ½å¼€é”€è¿‡å¤§ï¼Œå½±å“æ•´ä½“ç³»ç»Ÿæ€§èƒ½ã€‚</p>
<p><strong>HybridCache çš„è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ol type="1">
<li><strong>æœ¬åœ°ç¼“å­˜ä¼˜å…ˆ</strong>ï¼šä¼˜å…ˆä»æœ¬åœ°ç¼“å­˜è¯»å–ï¼Œå‡å°‘ç½‘ç»œå¼€é”€</li>
<li><strong>å¼‚æ­¥æ“ä½œ</strong>ï¼šæ‰€æœ‰ç¼“å­˜æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œé¿å…é˜»å¡çº¿ç¨‹</li>
<li><strong>è‡ªåŠ¨åºåˆ—åŒ–</strong>ï¼šè‡ªåŠ¨å¤„ç†åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œå‡å°‘æ‰‹åŠ¨è½¬æ¢çš„å¼€é”€</li>
</ol>
<div class="sourceCode" id="cb5"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// HybridCache è‡ªåŠ¨å¤„ç†æ€§èƒ½ä¼˜åŒ–</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> async Task<span class="op">&lt;</span>Product<span class="op">&gt;</span> <span class="fu">GetProductAsync</span><span class="op">(</span><span class="dt">int</span> productId<span class="op">)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// HybridCache ä¼šè‡ªåŠ¨ï¼š</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. ä¼˜å…ˆä»æœ¬åœ°ç¼“å­˜è¯»å–</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. å¼‚æ­¥è®¿é—®åˆ†å¸ƒå¼ç¼“å­˜</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3. è‡ªåŠ¨å¤„ç†åºåˆ—åŒ–</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> await _cache<span class="op">.</span><span class="fu">GetOrCreateAsync</span><span class="op">(</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        $<span class="st">&quot;product:{productId}&quot;</span><span class="op">,</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        async token <span class="op">=&gt;</span> await _dbContext<span class="op">.</span><span class="fu">Products</span><span class="op">.</span><span class="fu">FindAsync</span><span class="op">(</span>productId<span class="op">,</span> token<span class="op">)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="å››å¦‚ä½•ä¸€æ­¥æ­¥é›†æˆhybridcache">å››ã€å¦‚ä½•ä¸€æ­¥æ­¥é›†æˆHybridCache</h2>
<h3 id="å®‰è£…å¿…è¦çš„-nuget-åŒ…">4.1 å®‰è£…å¿…è¦çš„ NuGet åŒ…</h3>
<p>æ ¹æ® Microsoft å®˜æ–¹æ–‡æ¡£ï¼Œé¦–å…ˆéœ€è¦å®‰è£… HybridCache åŒ…ï¼š</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># æ ¸å¿ƒåŒ…</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">dotnet</span> add package Microsoft.Extensions.Caching.Hybrid</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># å¦‚æœä½¿ç”¨ Redis ä½œä¸ºåˆ†å¸ƒå¼ç¼“å­˜</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="ex">dotnet</span> add package Microsoft.Extensions.Caching.StackExchangeRedis</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># å¦‚æœä½¿ç”¨ SQL Server ä½œä¸ºåˆ†å¸ƒå¼ç¼“å­˜</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="ex">dotnet</span> add package Microsoft.Extensions.Caching.SqlServer</span></code></pre></div>
<h3 id="é…ç½®ä¾èµ–æ³¨å…¥">4.2 é…ç½®ä¾èµ–æ³¨å…¥</h3>
<p>åœ¨ <code>Program.cs</code> ä¸­é…ç½® HybridCacheï¼š</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Microsoft<span class="op">.</span><span class="fu">Extensions</span><span class="op">.</span><span class="fu">Caching</span><span class="op">.</span><span class="fu">Hybrid</span><span class="op">;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> Microsoft<span class="op">.</span><span class="fu">Extensions</span><span class="op">.</span><span class="fu">Caching</span><span class="op">.</span><span class="fu">StackExchangeRedis</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> builder <span class="op">=</span> WebApplication<span class="op">.</span><span class="fu">CreateBuilder</span><span class="op">(</span>args<span class="op">);</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">// æ­¥éª¤1ï¼šé…ç½® Redis åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆå¯é€‰ï¼‰</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddStackExchangeRedisCache</span><span class="op">(</span>options <span class="op">=&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">Configuration</span> <span class="op">=</span> <span class="st">&quot;localhost:6379&quot;</span><span class="op">;</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">InstanceName</span> <span class="op">=</span> <span class="st">&quot;MyApp_&quot;</span><span class="op">;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">// æ­¥éª¤2ï¼šæ·»åŠ  HybridCache</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddHybridCache</span><span class="op">();</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> app <span class="op">=</span> builder<span class="op">.</span><span class="fu">Build</span><span class="op">();</span></span></code></pre></div>
<h3 id="åˆ›å»ºæœåŠ¡ç±»å¹¶æ³¨å…¥-hybridcache">4.3 åˆ›å»ºæœåŠ¡ç±»å¹¶æ³¨å…¥
HybridCache</h3>
<p>åˆ›å»ºä¸€ä¸ªæœåŠ¡ç±»ï¼Œæ³¨å…¥ <code>HybridCache</code> ç±»ï¼š</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ProductService</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> HybridCache _cache<span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> AppDbContext _dbContext<span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">ProductService</span><span class="op">(</span>HybridCache cache<span class="op">,</span> AppDbContext dbContext<span class="op">)</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        _cache <span class="op">=</span> cache<span class="op">;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        _dbContext <span class="op">=</span> dbContext<span class="op">;</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>Product<span class="op">&gt;</span> <span class="fu">GetProductAsync</span><span class="op">(</span><span class="dt">int</span> productId<span class="op">)</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> await _cache<span class="op">.</span><span class="fu">GetOrCreateAsync</span><span class="op">(</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>            $<span class="st">&quot;product:{productId}&quot;</span><span class="op">,</span> <span class="co">// ç¼“å­˜é”®</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>            async token <span class="op">=&gt;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>                <span class="co">// ä»æ•°æ®åº“åŠ è½½æ•°æ®</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>                <span class="dt">var</span> product <span class="op">=</span> await _dbContext<span class="op">.</span><span class="fu">Products</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>                    <span class="op">.</span><span class="fu">FirstOrDefaultAsync</span><span class="op">(</span>p <span class="op">=&gt;</span> p<span class="op">.</span><span class="fu">Id</span> <span class="op">==</span> productId<span class="op">,</span> token<span class="op">);</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> product<span class="op">;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">},</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>            options <span class="op">=&gt;</span> options<span class="op">.</span><span class="fu">SlidingExpiration</span> <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromMinutes</span><span class="op">(</span><span class="dv">30</span><span class="op">)</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task <span class="fu">UpdateProductAsync</span><span class="op">(</span>Product product<span class="op">)</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>        <span class="co">// æ›´æ–°æ•°æ®åº“</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>        _dbContext<span class="op">.</span><span class="fu">Products</span><span class="op">.</span><span class="fu">Update</span><span class="op">(</span>product<span class="op">);</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>        await _dbContext<span class="op">.</span><span class="fu">SaveChangesAsync</span><span class="op">();</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">// æ›´æ–°ç¼“å­˜</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>        await _cache<span class="op">.</span><span class="fu">SetAsync</span><span class="op">(</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>            $<span class="st">&quot;product:{product.Id}&quot;</span><span class="op">,</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>            product<span class="op">,</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>            options <span class="op">=&gt;</span> options<span class="op">.</span><span class="fu">AbsoluteExpirationRelativeToNow</span> <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task <span class="fu">RemoveProductAsync</span><span class="op">(</span><span class="dt">int</span> productId<span class="op">)</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ä»æ•°æ®åº“åˆ é™¤</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> product <span class="op">=</span> await _dbContext<span class="op">.</span><span class="fu">Products</span><span class="op">.</span><span class="fu">FindAsync</span><span class="op">(</span>productId<span class="op">);</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>product <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>            _dbContext<span class="op">.</span><span class="fu">Products</span><span class="op">.</span><span class="fu">Remove</span><span class="op">(</span>product<span class="op">);</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>            await _dbContext<span class="op">.</span><span class="fu">SaveChangesAsync</span><span class="op">();</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ä»ç¼“å­˜åˆ é™¤</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>        await _cache<span class="op">.</span><span class="fu">RemoveAsync</span><span class="op">(</span>$<span class="st">&quot;product:{productId}&quot;</span><span class="op">);</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨">4.4 åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨</h3>
<p>åœ¨ ASP.NET Core æ§åˆ¶å™¨ä¸­ä½¿ç”¨æœåŠ¡ï¼š</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>ApiController<span class="op">]</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">Route</span><span class="op">(</span><span class="st">&quot;api/[controller]&quot;</span><span class="op">)]</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ProductsController <span class="op">:</span> ControllerBase</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> ProductService _productService<span class="op">;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">ProductsController</span><span class="op">(</span>ProductService productService<span class="op">)</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        _productService <span class="op">=</span> productService<span class="op">;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">HttpGet</span><span class="op">(</span><span class="st">&quot;{id}&quot;</span><span class="op">)]</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>ActionResult<span class="op">&lt;</span>Product<span class="op">&gt;&gt;</span> <span class="fu">GetProduct</span><span class="op">(</span><span class="dt">int</span> id<span class="op">)</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> product <span class="op">=</span> await _productService<span class="op">.</span><span class="fu">GetProductAsync</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>product <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="fu">NotFound</span><span class="op">();</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="fu">Ok</span><span class="op">(</span>product<span class="op">);</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">HttpPut</span><span class="op">(</span><span class="st">&quot;{id}&quot;</span><span class="op">)]</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>IActionResult<span class="op">&gt;</span> <span class="fu">UpdateProduct</span><span class="op">(</span><span class="dt">int</span> id<span class="op">,</span> Product product<span class="op">)</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>id <span class="op">!=</span> product<span class="op">.</span><span class="fu">Id</span><span class="op">)</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="fu">BadRequest</span><span class="op">();</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        await _productService<span class="op">.</span><span class="fu">UpdateProductAsync</span><span class="op">(</span>product<span class="op">);</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="fu">NoContent</span><span class="op">();</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">[</span><span class="fu">HttpDelete</span><span class="op">(</span><span class="st">&quot;{id}&quot;</span><span class="op">)]</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>IActionResult<span class="op">&gt;</span> <span class="fu">DeleteProduct</span><span class="op">(</span><span class="dt">int</span> id<span class="op">)</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>        await _productService<span class="op">.</span><span class="fu">RemoveProductAsync</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="fu">NoContent</span><span class="op">();</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="é«˜çº§é…ç½®">4.5 é«˜çº§é…ç½®</h3>
<h4 id="è‡ªå®šä¹‰åºåˆ—åŒ–å™¨">4.5.1 è‡ªå®šä¹‰åºåˆ—åŒ–å™¨</h4>
<p>å¦‚æœéœ€è¦ä½¿ç”¨è‡ªå®šä¹‰åºåˆ—åŒ–å™¨ï¼Œå¯ä»¥å®ç° <code>ICacheSerializer</code>
æ¥å£ï¼š</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> CustomCacheSerializer <span class="op">:</span> ICacheSerializer</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">byte</span><span class="op">[]</span> Serialize<span class="op">&lt;</span>T<span class="op">&gt;(</span>T value<span class="op">)</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// è‡ªå®šä¹‰åºåˆ—åŒ–é€»è¾‘</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> JsonSerializer<span class="op">.</span><span class="fu">SerializeToUtf8Bytes</span><span class="op">(</span>value<span class="op">);</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> T Deserialize<span class="op">&lt;</span>T<span class="op">&gt;(</span><span class="dt">byte</span><span class="op">[]</span> data<span class="op">)</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">// è‡ªå®šä¹‰ååºåˆ—åŒ–é€»è¾‘</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> JsonSerializer<span class="op">.</span><span class="fu">Deserialize</span><span class="op">&lt;</span>T<span class="op">&gt;(</span>data<span class="op">);</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">// åœ¨é…ç½®ä¸­ä½¿ç”¨</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddHybridCache</span><span class="op">(</span>options <span class="op">=&gt;</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">Serializer</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">CustomCacheSerializer</span><span class="op">();</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span></code></pre></div>
<h4 id="ä½¿ç”¨æ ‡ç­¾ç®¡ç†ç¼“å­˜">4.5.2 ä½¿ç”¨æ ‡ç­¾ç®¡ç†ç¼“å­˜</h4>
<p>ä½¿ç”¨æ ‡ç­¾æ¥æ‰¹é‡ç®¡ç†ç›¸å…³ç¼“å­˜ï¼š</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">// è®¾ç½®ç¼“å­˜æ—¶æ·»åŠ æ ‡ç­¾</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>await _cache<span class="op">.</span><span class="fu">SetAsync</span><span class="op">(</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    $<span class="st">&quot;product:{product.Id}&quot;</span><span class="op">,</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    product<span class="op">,</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    options <span class="op">=&gt;</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        options<span class="op">.</span><span class="fu">AbsoluteExpirationRelativeToNow</span> <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        options<span class="op">.</span><span class="fu">Tags</span> <span class="op">=</span> <span class="kw">new</span><span class="op">[]</span> <span class="op">{</span> $<span class="st">&quot;category:{product.CategoryId}&quot;</span> <span class="op">};</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">// æ ¹æ®æ ‡ç­¾æ‰¹é‡åˆ é™¤ç¼“å­˜</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>await _cache<span class="op">.</span><span class="fu">RemoveByTagAsync</span><span class="op">(</span>$<span class="st">&quot;category:{categoryId}&quot;</span><span class="op">);</span></span></code></pre></div>
<h4 id="é…ç½®æœ¬åœ°ç¼“å­˜è¿‡æœŸæ—¶é—´">4.5.3 é…ç½®æœ¬åœ°ç¼“å­˜è¿‡æœŸæ—¶é—´</h4>
<p>å¯ä»¥ä¸ºæœ¬åœ°ç¼“å­˜é…ç½®å•ç‹¬çš„è¿‡æœŸæ—¶é—´ï¼š</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddHybridCache</span><span class="op">(</span>options <span class="op">=&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">DefaultEntryOptions</span> <span class="op">=</span> <span class="kw">new</span> HybridCacheEntryOptions</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// åˆ†å¸ƒå¼ç¼“å­˜çš„è¿‡æœŸæ—¶é—´</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        AbsoluteExpirationRelativeToNow <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">// æœ¬åœ°ç¼“å­˜çš„è¿‡æœŸæ—¶é—´</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        LocalCacheExpiration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromMinutes</span><span class="op">(</span><span class="dv">10</span><span class="op">)</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span></code></pre></div>
<h2 id="äº”æœ€ä½³å®è·µ">äº”ã€æœ€ä½³å®è·µ</h2>
<h3 id="é€‰æ‹©åˆé€‚çš„ç¼“å­˜ç­–ç•¥">5.1 é€‰æ‹©åˆé€‚çš„ç¼“å­˜ç­–ç•¥</h3>
<ul>
<li><strong>è¯»å¤šå†™å°‘</strong>ï¼šä½¿ç”¨è¾ƒé•¿çš„è¿‡æœŸæ—¶é—´ï¼Œä¼˜å…ˆä»ç¼“å­˜è¯»å–</li>
<li><strong>è¯»å°‘å†™å¤š</strong>ï¼šä½¿ç”¨è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼ŒåŠæ—¶æ›´æ–°ç¼“å­˜</li>
<li><strong>çƒ­ç‚¹æ•°æ®</strong>ï¼šä½¿ç”¨æ»‘åŠ¨è¿‡æœŸï¼Œä¿æŒçƒ­ç‚¹æ•°æ®åœ¨ç¼“å­˜ä¸­</li>
<li><strong>å†·æ•°æ®</strong>ï¼šä½¿ç”¨ç»å¯¹è¿‡æœŸï¼Œé¿å…å ç”¨è¿‡å¤šå†…å­˜</li>
</ul>
<h3 id="ä½¿ç”¨æ ‡ç­¾ç®¡ç†ç›¸å…³ç¼“å­˜">5.2 ä½¿ç”¨æ ‡ç­¾ç®¡ç†ç›¸å…³ç¼“å­˜</h3>
<ul>
<li><strong>åˆ†ç±»æ ‡ç­¾</strong>ï¼šä¸ºä¸åŒç±»åˆ«çš„æ•°æ®è®¾ç½®ä¸åŒçš„æ ‡ç­¾</li>
<li><strong>æ‰¹é‡åˆ é™¤</strong>ï¼šä½¿ç”¨æ ‡ç­¾æ‰¹é‡åˆ é™¤ç›¸å…³ç¼“å­˜é¡¹</li>
<li><strong>çº¦æŸé€‰é¡¹</strong>ï¼šä½¿ç”¨çº¦æŸé€‰é¡¹æ¥æ§åˆ¶ç¼“å­˜è¡Œä¸º</li>
</ul>
<h3 id="å¤„ç†ç¼“å­˜æ•…éšœ">5.3 å¤„ç†ç¼“å­˜æ•…éšœ</h3>
<p>å½“ç¼“å­˜æœåŠ¡ä¸å¯ç”¨æ—¶ï¼Œæä¾›é™çº§æ–¹æ¡ˆï¼š</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> async Task<span class="op">&lt;</span>Product<span class="op">&gt;</span> <span class="fu">GetProductAsync</span><span class="op">(</span><span class="dt">int</span> productId<span class="op">)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">try</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> await _cache<span class="op">.</span><span class="fu">GetOrCreateAsync</span><span class="op">(</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>            $<span class="st">&quot;product:{productId}&quot;</span><span class="op">,</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>            async token <span class="op">=&gt;</span> await _dbContext<span class="op">.</span><span class="fu">Products</span><span class="op">.</span><span class="fu">FindAsync</span><span class="op">(</span>productId<span class="op">,</span> token<span class="op">)</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">catch</span> <span class="op">(</span>Exception ex<span class="op">)</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        _logger<span class="op">.</span><span class="fu">LogWarning</span><span class="op">(</span>ex<span class="op">,</span> <span class="st">&quot;Cache service unavailable, falling back to database&quot;</span><span class="op">);</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é™çº§æ–¹æ¡ˆï¼šç›´æ¥ä»æ•°æ®åº“è¯»å–</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> await _dbContext<span class="op">.</span><span class="fu">Products</span><span class="op">.</span><span class="fu">FindAsync</span><span class="op">(</span>productId<span class="op">);</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="å…­æ€»ç»“">å…­ã€æ€»ç»“</h2>
<p>HybridCache
æ˜¯ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„ç¼“å­˜æ¡†æ¶ï¼Œå®ƒé€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³äº†ä¼ ç»Ÿç¼“å­˜æ–¹æ¡ˆçš„é—®é¢˜ï¼š</p>
<ol type="1">
<li><strong>ç»Ÿä¸€API</strong>ï¼šä¸ºè¿›ç¨‹å†…å’Œè¿›ç¨‹å¤–ç¼“å­˜æä¾›ç»Ÿä¸€çš„APIï¼Œç®€åŒ–äº†ç¼“å­˜æ“ä½œ</li>
<li><strong>è‡ªåŠ¨åŒ–ç®¡ç†</strong>ï¼šè‡ªåŠ¨å¤„ç†ç¼“å­˜åŒæ­¥ã€è¿‡æœŸã€åºåˆ—åŒ–ç­‰å¤æ‚é€»è¾‘</li>
<li><strong>æ ‡ç­¾æ”¯æŒ</strong>ï¼šæ”¯æŒæ ‡ç­¾æ¥æ‰¹é‡ç®¡ç†ç›¸å…³ç¼“å­˜é¡¹ï¼Œæä¾›æ›´çµæ´»çš„ç¼“å­˜ç®¡ç†</li>
<li><strong>æ˜“äºé›†æˆ</strong>ï¼šç®€å•çš„ API
è®¾è®¡ï¼Œå¿«é€Ÿé›†æˆåˆ°ç°æœ‰é¡¹ç›®ä¸­</li>
</ol>
<p>é€šè¿‡åˆç†ä½¿ç”¨
HybridCacheï¼Œå¯ä»¥æ˜¾è‘—æå‡åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå¯é æ€§ï¼ŒåŒæ—¶é™ä½ç¼“å­˜ç®¡ç†çš„å¤æ‚åº¦ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå»ºè®®æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„ç¼“å­˜ç­–ç•¥ï¼Œå¹¶æŒç»­ç›‘æ§å’Œä¼˜åŒ–ç¼“å­˜æ•ˆæœã€‚</p>
<h2 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h2>
<ul>
<li><a
href="https://learn.microsoft.com/zh-cn/aspnet/core/performance/caching/hybrid?view=aspnetcore-9.0">ASP.NET
Core ä¸­çš„ HybridCache åº“ | Microsoft Learn</a></li>
<li><a
href="https://learn.microsoft.com/zh-cn/aspnet/core/performance/caching/overview?view=aspnetcore-9.0">ASP.NET
Core ä¸­çš„ç¼“å­˜æ¦‚è¿° | Microsoft Learn</a></li>
<li><a
href="https://learn.microsoft.com/zh-cn/aspnet/core/release-notes/aspnetcore-9.0?view=aspnetcore-9.0">.NET
9 ASP.NET Core ä¸­çš„æ–°å¢åŠŸèƒ½ | Microsoft Learn</a></li>
</ul>

                </article>
            </div>
        </section>

        <!-- å³ä¾§çƒ­é—¨æ–‡ç«  -->
        <aside class="popular-sidebar">
            <div class="popular-header">
                <h3>çƒ­é—¨æ–‡ç« </h3>
            </div>
            <div class="popular-list" id="popular-list">
                <!-- åŠ¨æ€ç”Ÿæˆçš„çƒ­é—¨æ–‡ç« åˆ—è¡¨ -->
            </div>
        </aside>
    </main>

    <!-- JavaScript -->
    <script type="module" src="/script.js?v=2.2.0"></script>
</body>
</html>