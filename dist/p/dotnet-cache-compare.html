<!DOCTYPE html>
<html lang="zh-CN" class="page-article">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ğŸ”„ .NET ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯” - å…³é”®è¯: NET, ç¼“å­˜, ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯”">
    <meta name="keywords" content="NET, ç¼“å­˜, ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯”">
    <meta name="author" content="Ken Wang">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://kenwang007.github.io/dist/p/dotnet-cache-compare.html">
    <meta property="og:title" content="ğŸ”„ .NET ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯” - Kençš„çŸ¥è¯†åº“">
    <meta property="og:description" content="ğŸ”„ .NET ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯” - å…³é”®è¯: NET, ç¼“å­˜, ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯”">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary">
    <meta property="twitter:url" content="https://kenwang007.github.io/dist/p/dotnet-cache-compare.html">
    <meta property="twitter:title" content="ğŸ”„ .NET ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯” - Kençš„çŸ¥è¯†åº“">
    <meta property="twitter:description" content="ğŸ”„ .NET ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯” - å…³é”®è¯: NET, ç¼“å­˜, ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯”">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#6366f1">
    
    <title>ğŸ”„ .NET ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯” - Kençš„çŸ¥è¯†åº“</title>
    <link rel="stylesheet" href="/style.css?v=2.1.2">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22 fill=%22%236366f1%22>ğŸ“š</text></svg>">
    <link rel="canonical" href="https://kenwang007.github.io/dist/p/dotnet-cache-compare.html">
    <link rel="manifest" href="/manifest.json">
    
    <!-- RSS Feed -->
    <link rel="alternate" type="application/rss+xml" title="Kençš„çŸ¥è¯†åº“ RSS Feed" href="/rss.xml">
    
    <!-- Breadcrumb Navigation -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "é¦–é¡µ",
          "item": "https://kenwang007.github.io/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "ğŸ”„ .NET ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯”",
          "item": "https://kenwang007.github.io/dist/p/dotnet-cache-compare.html"
        }
      ]
    }
    </script>
    
    <!-- Article Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "ğŸ”„ .NET ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯”",
      "description": "ğŸ”„ .NET ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯” - å…³é”®è¯: NET, ç¼“å­˜, ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯”",
      "author": {
        "@type": "Person",
        "name": "Ken Wang"
      },
      "datePublished": "2026-01-29T20:26:18.620549",
      "dateModified": "2026-01-29T20:26:18.620549",
      "inLanguage": "zh-CN"
    }
    </script>
</head>
<body>
    <!-- æ˜Ÿç©ºèƒŒæ™¯ -->
    <div class="stars"></div>
    <div class="stars2"></div>
    <div class="stars3"></div>

    <!-- é¡¶éƒ¨å›ºå®šå¯¼èˆª -->
    <header class="top-nav">
        <div class="nav-container">
            <div class="logo">
                <a href="/index.html">
                    <span class="logo-text">ğŸ“š Kençš„çŸ¥è¯†åº“</span>
                </a>
            </div>
            <nav class="main-nav">
                <ul id="nav-menu" class="nav-menu">
                    <!-- åŠ¨æ€ç”Ÿæˆçš„å¯¼èˆªèœå•é¡¹ -->
                </ul>
            </nav>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
        <!-- å·¦ä¾§å›ºå®šå…³é”®è¯ç´¢å¼• -->
        <aside class="keyword-sidebar">
            <div class="keyword-header">
                <h3>å…³é”®è¯ç´¢å¼•</h3>
            </div>
            <div class="keyword-list" id="keyword-list">
                <!-- åŠ¨æ€ç”Ÿæˆçš„å…³é”®è¯ -->
            </div>
        </aside>

        <!-- ä¸­é—´ä¸»å†…å®¹ -->
        <section class="content-area">
            <div class="content-wrapper">
                <article class="markdown-content">
                    
<h1 id="net-ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯”">ğŸ”„ .NET ç¼“å­˜æ¡†æ¶å…¨é¢å¯¹æ¯”</h1>
<h2 id="net-ç¼“å­˜è§£å†³æ–¹æ¡ˆæ¦‚è§ˆ">1. .NET ç¼“å­˜è§£å†³æ–¹æ¡ˆæ¦‚è§ˆ</h2>
<h3 id="ç¼“å­˜æ–¹æ¡ˆåˆ†ç±»">1.1 ç¼“å­˜æ–¹æ¡ˆåˆ†ç±»</h3>
<table>
<colgroup>
<col style="width: 27%" />
<col style="width: 27%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr>
<th>åˆ†ç±»</th>
<th>æ–¹æ¡ˆ</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æœ¬åœ°ç¼“å­˜</strong></td>
<td>IMemoryCacheã€LazyCache</td>
<td>å•æœºåº”ç”¨ã€é«˜é¢‘è®¿é—®</td>
</tr>
<tr>
<td><strong>åˆ†å¸ƒå¼ç¼“å­˜</strong></td>
<td>IDistributedCacheã€Redisã€Memcached</td>
<td>é›†ç¾¤éƒ¨ç½²ã€æ•°æ®å…±äº«</td>
</tr>
<tr>
<td><strong>æ··åˆç¼“å­˜</strong></td>
<td>HybridCacheã€FusionCache</td>
<td>å¤šçº§ç¼“å­˜ã€é«˜å¯ç”¨</td>
</tr>
<tr>
<td><strong>HTTP ç¼“å­˜</strong></td>
<td>ResponseCachingã€OutputCache</td>
<td>API å“åº”ç¼“å­˜</td>
</tr>
<tr>
<td><strong>æ•°æ®è®¿é—®ç¼“å­˜</strong></td>
<td>EF Core äºŒçº§ç¼“å­˜</td>
<td>ORM æŸ¥è¯¢ç»“æœç¼“å­˜</td>
</tr>
</tbody>
</table>
<h3 id="æŠ€æœ¯æ ˆå…¨æ™¯å›¾">1.2 æŠ€æœ¯æ ˆå…¨æ™¯å›¾</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    .NET ç¼“å­˜æŠ€æœ¯æ ˆ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  å¾®è½¯å®˜æ–¹                          å¼€æºç¤¾åŒº                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚  â€¢ IMemoryCache                    â€¢ FusionCache            â”‚
â”‚  â€¢ IDistributedCache               â€¢ LazyCache              â”‚
â”‚  â€¢ HybridCache (.NET 9)            â€¢ CacheManager           â”‚
â”‚  â€¢ ResponseCaching                 â€¢ EasyCaching            â”‚
â”‚  â€¢ OutputCache (.NET 7+)           â€¢ Cashew                 â”‚
â”‚                                    â€¢ Akavache               â”‚
â”‚                                                             â”‚
â”‚  åˆ†å¸ƒå¼ç¼“å­˜åç«¯                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                           â”‚
â”‚  â€¢ Redis (StackExchange.Redis)                              â”‚
â”‚  â€¢ SQL Server                                               â”‚
â”‚  â€¢ NCache                                                   â”‚
â”‚  â€¢ Memcached                                                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<hr />
<h2 id="å¾®è½¯å®˜æ–¹ç¼“å­˜æ¡†æ¶">2. å¾®è½¯å®˜æ–¹ç¼“å­˜æ¡†æ¶</h2>
<h3 id="imemorycacheæœ¬åœ°ç¼“å­˜">2.1 IMemoryCacheï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰</h3>
<p><strong>åŒ…</strong>:
<code>Microsoft.Extensions.Caching.Memory</code></p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">// æ³¨å†Œ</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddMemoryCache</span><span class="op">();</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ä½¿ç”¨</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ProductService</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> IMemoryCache _cache<span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Product<span class="op">?</span> <span class="fu">GetProduct</span><span class="op">(</span><span class="dt">int</span> id<span class="op">)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> _cache<span class="op">.</span><span class="fu">GetOrCreate</span><span class="op">(</span>$<span class="st">&quot;product:{id}&quot;</span><span class="op">,</span> entry <span class="op">=&gt;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            entry<span class="op">.</span><span class="fu">AbsoluteExpirationRelativeToNow</span> <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>            entry<span class="op">.</span><span class="fu">SlidingExpiration</span> <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromMinutes</span><span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>            entry<span class="op">.</span><span class="fu">Priority</span> <span class="op">=</span> CacheItemPriority<span class="op">.</span><span class="fu">High</span><span class="op">;</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> _repository<span class="op">.</span><span class="fu">GetById</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å­˜å‚¨ä½ç½®</strong></td>
<td>è¿›ç¨‹å†…å­˜</td>
</tr>
<tr>
<td><strong>è¿‡æœŸç­–ç•¥</strong></td>
<td>ç»å¯¹è¿‡æœŸã€æ»‘åŠ¨è¿‡æœŸ</td>
</tr>
<tr>
<td><strong>æ·˜æ±°ç­–ç•¥</strong></td>
<td>LRU + Priority</td>
</tr>
<tr>
<td><strong>å¤§å°é™åˆ¶</strong></td>
<td>å¯é…ç½® SizeLimit</td>
</tr>
<tr>
<td><strong>çº¿ç¨‹å®‰å…¨</strong></td>
<td>âœ… æ˜¯</td>
</tr>
<tr>
<td><strong>åºåˆ—åŒ–</strong></td>
<td>ä¸éœ€è¦</td>
</tr>
</tbody>
</table>
<p><strong>é™åˆ¶</strong>ï¼š - âŒ ä¸æ”¯æŒåˆ†å¸ƒå¼ - âŒ åº”ç”¨é‡å¯æ•°æ®ä¸¢å¤± - âŒ
å¤šå®ä¾‹æ•°æ®ä¸åŒæ­¥</p>
<h3 id="idistributedcacheåˆ†å¸ƒå¼ç¼“å­˜æŠ½è±¡">2.2
IDistributedCacheï¼ˆåˆ†å¸ƒå¼ç¼“å­˜æŠ½è±¡ï¼‰</h3>
<p><strong>åŒ…</strong>:
<code>Microsoft.Extensions.Caching.Distributed</code></p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Redis å®ç°</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddStackExchangeRedisCache</span><span class="op">(</span>options <span class="op">=&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">Configuration</span> <span class="op">=</span> <span class="st">&quot;localhost:6379&quot;</span><span class="op">;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">InstanceName</span> <span class="op">=</span> <span class="st">&quot;MyApp:&quot;</span><span class="op">;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">// SQL Server å®ç°</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddDistributedSqlServerCache</span><span class="op">(</span>options <span class="op">=&gt;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">ConnectionString</span> <span class="op">=</span> connectionString<span class="op">;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">SchemaName</span> <span class="op">=</span> <span class="st">&quot;dbo&quot;</span><span class="op">;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">TableName</span> <span class="op">=</span> <span class="st">&quot;CacheTable&quot;</span><span class="op">;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">// ä½¿ç”¨</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ProductService</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> IDistributedCache _cache<span class="op">;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>Product<span class="op">?&gt;</span> <span class="fu">GetProductAsync</span><span class="op">(</span><span class="dt">int</span> id<span class="op">)</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> key <span class="op">=</span> $<span class="st">&quot;product:{id}&quot;</span><span class="op">;</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> cached <span class="op">=</span> await _cache<span class="op">.</span><span class="fu">GetStringAsync</span><span class="op">(</span>key<span class="op">);</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>cached <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> JsonSerializer<span class="op">.</span><span class="fu">Deserialize</span><span class="op">&lt;</span>Product<span class="op">&gt;(</span>cached<span class="op">);</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> product <span class="op">=</span> await _repository<span class="op">.</span><span class="fu">GetByIdAsync</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>product <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>            await _cache<span class="op">.</span><span class="fu">SetStringAsync</span><span class="op">(</span>key<span class="op">,</span> JsonSerializer<span class="op">.</span><span class="fu">Serialize</span><span class="op">(</span>product<span class="op">),</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>                <span class="kw">new</span> DistributedCacheEntryOptions</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>                    AbsoluteExpirationRelativeToNow <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>                <span class="op">});</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> product<span class="op">;</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<table>
<colgroup>
<col style="width: 35%" />
<col style="width: 29%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr>
<th>å®ç°</th>
<th>åŒ…</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Redis</strong></td>
<td><code>Microsoft.Extensions.Caching.StackExchangeRedis</code></td>
<td>æœ€å¸¸ç”¨ï¼Œæ€§èƒ½å¥½</td>
</tr>
<tr>
<td><strong>SQL Server</strong></td>
<td><code>Microsoft.Extensions.Caching.SqlServer</code></td>
<td>åˆ©ç”¨ç°æœ‰æ•°æ®åº“</td>
</tr>
<tr>
<td><strong>Memory</strong></td>
<td><code>Microsoft.Extensions.Caching.Memory</code></td>
<td>æµ‹è¯•/å¼€å‘ç”¨</td>
</tr>
<tr>
<td><strong>NCache</strong></td>
<td><code>NCache.Microsoft.Extensions.Caching</code></td>
<td>ä¼ä¸šçº§æ–¹æ¡ˆ</td>
</tr>
</tbody>
</table>
<p><strong>é™åˆ¶</strong>ï¼š - âŒ API è¿‡äºç®€å•ï¼Œåªæ”¯æŒ byte[] - âŒ
ä¸æ”¯æŒé˜²å‡»ç©¿ - âŒ ä¸æ”¯æŒå¤šçº§ç¼“å­˜ - âŒ éœ€è¦æ‰‹åŠ¨åºåˆ—åŒ–</p>
<h3 id="hybridcache.net-9-æ–°å¢">2.3 HybridCacheï¼ˆ.NET 9 æ–°å¢ï¼‰</h3>
<p><strong>åŒ…</strong>:
<code>Microsoft.Extensions.Caching.Hybrid</code></p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// æ³¨å†Œ</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddHybridCache</span><span class="op">(</span>options <span class="op">=&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">DefaultEntryOptions</span> <span class="op">=</span> <span class="kw">new</span> HybridCacheEntryOptions</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        Expiration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        LocalCacheExpiration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromMinutes</span><span class="op">(</span><span class="dv">5</span><span class="op">)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">// é…ç½® Redis ä½œä¸º L2 ç¼“å­˜</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddStackExchangeRedisCache</span><span class="op">(</span>options <span class="op">=&gt;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">Configuration</span> <span class="op">=</span> <span class="st">&quot;localhost:6379&quot;</span><span class="op">;</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">// ä½¿ç”¨</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ProductService</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> HybridCache _cache<span class="op">;</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>Product<span class="op">&gt;</span> <span class="fu">GetProductAsync</span><span class="op">(</span><span class="dt">int</span> id<span class="op">)</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> await _cache<span class="op">.</span><span class="fu">GetOrCreateAsync</span><span class="op">(</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>            $<span class="st">&quot;product:{id}&quot;</span><span class="op">,</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            async cancel <span class="op">=&gt;</span> await _repository<span class="op">.</span><span class="fu">GetByIdAsync</span><span class="op">(</span>id<span class="op">,</span> cancel<span class="op">)</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// å¸¦æ ‡ç­¾ï¼Œæ”¯æŒæ‰¹é‡å¤±æ•ˆ</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>Product<span class="op">&gt;</span> <span class="fu">GetProductWithTagsAsync</span><span class="op">(</span><span class="dt">int</span> id<span class="op">)</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> await _cache<span class="op">.</span><span class="fu">GetOrCreateAsync</span><span class="op">(</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>            $<span class="st">&quot;product:{id}&quot;</span><span class="op">,</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>            async cancel <span class="op">=&gt;</span> await _repository<span class="op">.</span><span class="fu">GetByIdAsync</span><span class="op">(</span>id<span class="op">,</span> cancel<span class="op">),</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> HybridCacheEntryOptions <span class="op">{</span> Expiration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">},</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>            tags<span class="op">:</span> <span class="op">[</span><span class="st">&quot;products&quot;</span><span class="op">,</span> $<span class="st">&quot;category:{categoryId}&quot;</span><span class="op">]</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">// æŒ‰æ ‡ç­¾æ‰¹é‡å¤±æ•ˆ</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task <span class="fu">InvalidateCategoryAsync</span><span class="op">(</span><span class="dt">int</span> categoryId<span class="op">)</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>        await _cache<span class="op">.</span><span class="fu">RemoveByTagAsync</span><span class="op">(</span>$<span class="st">&quot;category:{categoryId}&quot;</span><span class="op">);</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å¤šçº§ç¼“å­˜</strong></td>
<td>è‡ªåŠ¨ L1(Memory) + L2(Redis)</td>
</tr>
<tr>
<td><strong>é˜²å‡»ç©¿</strong></td>
<td>å†…ç½® Stampede Protection</td>
</tr>
<tr>
<td><strong>åºåˆ—åŒ–</strong></td>
<td>è‡ªåŠ¨å¤„ç†</td>
</tr>
<tr>
<td><strong>æ ‡ç­¾å¤±æ•ˆ</strong></td>
<td>æ”¯æŒæŒ‰æ ‡ç­¾æ‰¹é‡åˆ é™¤</td>
</tr>
<tr>
<td><strong>ç±»å‹å®‰å…¨</strong></td>
<td>æ³›å‹ API</td>
</tr>
</tbody>
</table>
<p><strong>é™åˆ¶</strong>ï¼š - âŒ ä»… .NET 9+ æ”¯æŒ - âŒ ç›¸å¯¹è¾ƒæ–°ï¼Œç”Ÿæ€ä¸å¦‚
FusionCache</p>
<h3 id="outputcache.net-7">2.4 OutputCacheï¼ˆ.NET 7+ï¼‰</h3>
<p><strong>åŒ…</strong>:
<code>Microsoft.AspNetCore.OutputCaching</code></p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// æ³¨å†Œ</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddOutputCache</span><span class="op">(</span>options <span class="op">=&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">AddBasePolicy</span><span class="op">(</span>builder <span class="op">=&gt;</span> builder<span class="op">.</span><span class="fu">Expire</span><span class="op">(</span>TimeSpan<span class="op">.</span><span class="fu">FromMinutes</span><span class="op">(</span><span class="dv">10</span><span class="op">)));</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">AddPolicy</span><span class="op">(</span><span class="st">&quot;Products&quot;</span><span class="op">,</span> builder <span class="op">=&gt;</span> builder</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">Expire</span><span class="op">(</span>TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">))</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">Tag</span><span class="op">(</span><span class="st">&quot;products&quot;</span><span class="op">));</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">// ä½¿ç”¨ Redis åç«¯</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddStackExchangeRedisOutputCache</span><span class="op">(</span>options <span class="op">=&gt;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">Configuration</span> <span class="op">=</span> <span class="st">&quot;localhost:6379&quot;</span><span class="op">;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>app<span class="op">.</span><span class="fu">UseOutputCache</span><span class="op">();</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co">// æ§åˆ¶å™¨ä¸­ä½¿ç”¨</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">OutputCache</span><span class="op">(</span>PolicyName <span class="op">=</span> <span class="st">&quot;Products&quot;</span><span class="op">)]</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="op">[</span><span class="fu">HttpGet</span><span class="op">(</span><span class="st">&quot;{id}&quot;</span><span class="op">)]</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> async Task<span class="op">&lt;</span>Product<span class="op">&gt;</span> <span class="fu">GetProduct</span><span class="op">(</span><span class="dt">int</span> id<span class="op">)</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> await _service<span class="op">.</span><span class="fu">GetProductAsync</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="co">// æ‰‹åŠ¨å¤±æ•ˆ</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> async Task <span class="fu">UpdateProduct</span><span class="op">(</span>Product product<span class="op">)</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    await _repository<span class="op">.</span><span class="fu">UpdateAsync</span><span class="op">(</span>product<span class="op">);</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    await _outputCache<span class="op">.</span><span class="fu">EvictByTagAsync</span><span class="op">(</span><span class="st">&quot;products&quot;</span><span class="op">,</span> <span class="kw">default</span><span class="op">);</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ç¼“å­˜å±‚çº§</strong></td>
<td>HTTP å“åº”çº§åˆ«</td>
</tr>
<tr>
<td><strong>å­˜å‚¨</strong></td>
<td>å†…å­˜/Redis</td>
</tr>
<tr>
<td><strong>å¤±æ•ˆæœºåˆ¶</strong></td>
<td>æ ‡ç­¾ã€VaryBy</td>
</tr>
<tr>
<td><strong>è‡ªå®šä¹‰ç­–ç•¥</strong></td>
<td>çµæ´»é…ç½®</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="å¼€æºç¼“å­˜æ¡†æ¶">3. å¼€æºç¼“å­˜æ¡†æ¶</h2>
<h3 id="fusioncache-æ¨è">3.1 FusionCacheï¼ˆâ­ æ¨èï¼‰</h3>
<p><strong>åŒ…</strong>: <code>ZiggyCreatures.FusionCache</code></p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">// æ³¨å†Œ</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddFusionCache</span><span class="op">()</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithDefaultEntryOptions</span><span class="op">(</span><span class="kw">new</span> FusionCacheEntryOptions</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        Duration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é˜²å‡»ç©¿ï¼šæ•…éšœå®‰å…¨</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        IsFailSafeEnabled <span class="op">=</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        FailSafeMaxDuration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromDays</span><span class="op">(</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        FailSafeThrottleDuration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromSeconds</span><span class="op">(</span><span class="dv">30</span><span class="op">),</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é˜²å‡»ç©¿ï¼šå·¥å‚è¶…æ—¶</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        FactorySoftTimeout <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromMilliseconds</span><span class="op">(</span><span class="dv">100</span><span class="op">),</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        FactoryHardTimeout <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromSeconds</span><span class="op">(</span><span class="dv">2</span><span class="op">),</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é˜²é›ªå´©ï¼šéšæœºæŠ–åŠ¨</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        JitterMaxDuration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromMinutes</span><span class="op">(</span><span class="dv">2</span><span class="op">),</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// åå°åˆ·æ–°</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        AllowBackgroundDistributedCacheOperations <span class="op">=</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        AllowBackgroundBackplaneOperations <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">})</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// L2: Redis</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithDistributedCache</span><span class="op">(</span><span class="kw">new</span> <span class="fu">RedisCache</span><span class="op">(</span><span class="kw">new</span> RedisCacheOptions</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>        Configuration <span class="op">=</span> <span class="st">&quot;localhost:6379&quot;</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}))</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// åºåˆ—åŒ–</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithSerializer</span><span class="op">(</span><span class="kw">new</span> <span class="fu">FusionCacheSystemTextJsonSerializer</span><span class="op">())</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">// èƒŒæ¿ï¼ˆå¤šå®ä¾‹åŒæ­¥ï¼‰</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">WithBackplane</span><span class="op">(</span><span class="kw">new</span> <span class="fu">RedisBackplane</span><span class="op">(</span><span class="kw">new</span> RedisBackplaneOptions</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>        Configuration <span class="op">=</span> <span class="st">&quot;localhost:6379&quot;</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}));</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="co">// ä½¿ç”¨</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ProductService</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> IFusionCache _cache<span class="op">;</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>Product<span class="op">?&gt;</span> <span class="fu">GetProductAsync</span><span class="op">(</span><span class="dt">int</span> id<span class="op">)</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> await _cache<span class="op">.</span><span class="fu">GetOrSetAsync</span><span class="op">(</span></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>            $<span class="st">&quot;product:{id}&quot;</span><span class="op">,</span></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>            async ct <span class="op">=&gt;</span> await _repository<span class="op">.</span><span class="fu">GetByIdAsync</span><span class="op">(</span>id<span class="op">,</span> ct<span class="op">),</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> FusionCacheEntryOptions</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>                Duration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>                FailSafeMaxDuration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromDays</span><span class="op">(</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Adaptive Cachingï¼šæ ¹æ®æ•°æ®åŠ¨æ€è°ƒæ•´ç¼“å­˜ç­–ç•¥</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>Product<span class="op">?&gt;</span> <span class="fu">GetProductAdaptiveAsync</span><span class="op">(</span><span class="dt">int</span> id<span class="op">)</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> await _cache<span class="op">.</span><span class="fu">GetOrSetAsync</span><span class="op">(</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>            $<span class="st">&quot;product:{id}&quot;</span><span class="op">,</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>            <span class="fu">async</span> <span class="op">(</span>ctx<span class="op">,</span> ct<span class="op">)</span> <span class="op">=&gt;</span></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>                <span class="dt">var</span> product <span class="op">=</span> await _repository<span class="op">.</span><span class="fu">GetByIdAsync</span><span class="op">(</span>id<span class="op">,</span> ct<span class="op">);</span></span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>                <span class="co">// æ ¹æ®æ•°æ®ç‰¹å¾åŠ¨æ€è°ƒæ•´ç¼“å­˜æ—¶é—´</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>product<span class="op">?.</span><span class="fu">IsHotSale</span> <span class="op">==</span> <span class="kw">true</span><span class="op">)</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>                    ctx<span class="op">.</span><span class="fu">Options</span><span class="op">.</span><span class="fu">Duration</span> <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromMinutes</span><span class="op">(</span><span class="dv">5</span><span class="op">);</span>  <span class="co">// çƒ­é”€å“çŸ­ç¼“å­˜</span></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>                <span class="kw">else</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>                    ctx<span class="op">.</span><span class="fu">Options</span><span class="op">.</span><span class="fu">Duration</span> <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">2</span><span class="op">);</span>    <span class="co">// æ™®é€šå“é•¿ç¼“å­˜</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> product<span class="op">;</span></span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>æ”¯æŒæƒ…å†µ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å¤šçº§ç¼“å­˜</strong></td>
<td>âœ… L1 + L2</td>
</tr>
<tr>
<td><strong>é˜²å‡»ç©¿</strong></td>
<td>âœ… å†…ç½®é” + æ•…éšœå®‰å…¨</td>
</tr>
<tr>
<td><strong>é˜²é›ªå´©</strong></td>
<td>âœ… Jitter</td>
</tr>
<tr>
<td><strong>èƒŒæ¿åŒæ­¥</strong></td>
<td>âœ… Redis/Memory</td>
</tr>
<tr>
<td><strong>Eager Refresh</strong></td>
<td>âœ… æå‰åˆ·æ–°</td>
</tr>
<tr>
<td><strong>Adaptive Caching</strong></td>
<td>âœ… åŠ¨æ€ç­–ç•¥</td>
</tr>
<tr>
<td><strong>OpenTelemetry</strong></td>
<td>âœ… å¯è§‚æµ‹æ€§</td>
</tr>
<tr>
<td><strong>æœ€ä½ç‰ˆæœ¬</strong></td>
<td>.NET Standard 2.0</td>
</tr>
</tbody>
</table>
<h3 id="lazycache">3.2 LazyCache</h3>
<p><strong>åŒ…</strong>: <code>LazyCache</code></p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// æ³¨å†Œ</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddLazyCache</span><span class="op">();</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ä½¿ç”¨</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ProductService</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> IAppCache _cache<span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>Product<span class="op">?&gt;</span> <span class="fu">GetProductAsync</span><span class="op">(</span><span class="dt">int</span> id<span class="op">)</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> await _cache<span class="op">.</span><span class="fu">GetOrAddAsync</span><span class="op">(</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            $<span class="st">&quot;product:{id}&quot;</span><span class="op">,</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            async entry <span class="op">=&gt;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                entry<span class="op">.</span><span class="fu">AbsoluteExpirationRelativeToNow</span> <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> await _repository<span class="op">.</span><span class="fu">GetByIdAsync</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>æ”¯æŒæƒ…å†µ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å¤šçº§ç¼“å­˜</strong></td>
<td>âŒ ä»…æœ¬åœ°</td>
</tr>
<tr>
<td><strong>é˜²å‡»ç©¿</strong></td>
<td>âœ… å†…ç½®é”</td>
</tr>
<tr>
<td><strong>API ç®€æ´åº¦</strong></td>
<td>â­â­â­â­â­</td>
</tr>
<tr>
<td><strong>å­¦ä¹ æ›²çº¿</strong></td>
<td>ä½</td>
</tr>
<tr>
<td><strong>é€‚ç”¨åœºæ™¯</strong></td>
<td>ç®€å•æœ¬åœ°ç¼“å­˜</td>
</tr>
</tbody>
</table>
<h3 id="easycaching">3.3 EasyCaching</h3>
<p><strong>åŒ…</strong>: <code>EasyCaching.Core</code></p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">// æ³¨å†Œå¤šçº§ç¼“å­˜</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">Services</span><span class="op">.</span><span class="fu">AddEasyCaching</span><span class="op">(</span>options <span class="op">=&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// L1: å†…å­˜</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">UseInMemory</span><span class="op">(</span><span class="st">&quot;m1&quot;</span><span class="op">);</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// L2: Redis</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">UseRedis</span><span class="op">(</span>config <span class="op">=&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        config<span class="op">.</span><span class="fu">DBConfig</span><span class="op">.</span><span class="fu">Endpoints</span><span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> <span class="fu">ServerEndPoint</span><span class="op">(</span><span class="st">&quot;localhost&quot;</span><span class="op">,</span> <span class="dv">6379</span><span class="op">));</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">},</span> <span class="st">&quot;r1&quot;</span><span class="op">);</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// æ··åˆç¼“å­˜</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">UseHybrid</span><span class="op">(</span>config <span class="op">=&gt;</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        config<span class="op">.</span><span class="fu">TopicName</span> <span class="op">=</span> <span class="st">&quot;cache-sync&quot;</span><span class="op">;</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        config<span class="op">.</span><span class="fu">LocalCacheProviderName</span> <span class="op">=</span> <span class="st">&quot;m1&quot;</span><span class="op">;</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        config<span class="op">.</span><span class="fu">DistributedCacheProviderName</span> <span class="op">=</span> <span class="st">&quot;r1&quot;</span><span class="op">;</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Redis æ€»çº¿ï¼ˆå¤šå®ä¾‹åŒæ­¥ï¼‰</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">WithRedisBus</span><span class="op">(</span>config <span class="op">=&gt;</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        config<span class="op">.</span><span class="fu">Endpoints</span><span class="op">.</span><span class="fu">Add</span><span class="op">(</span><span class="kw">new</span> <span class="fu">ServerEndPoint</span><span class="op">(</span><span class="st">&quot;localhost&quot;</span><span class="op">,</span> <span class="dv">6379</span><span class="op">));</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">});</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co">// ä½¿ç”¨</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ProductService</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> IHybridCachingProvider _cache<span class="op">;</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>Product<span class="op">?&gt;</span> <span class="fu">GetProductAsync</span><span class="op">(</span><span class="dt">int</span> id<span class="op">)</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> result <span class="op">=</span> await _cache<span class="op">.</span><span class="fu">GetAsync</span><span class="op">&lt;</span>Product<span class="op">&gt;(</span>$<span class="st">&quot;product:{id}&quot;</span><span class="op">);</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>result<span class="op">.</span><span class="fu">HasValue</span><span class="op">)</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> result<span class="op">.</span><span class="fu">Value</span><span class="op">;</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> product <span class="op">=</span> await _repository<span class="op">.</span><span class="fu">GetByIdAsync</span><span class="op">(</span>id<span class="op">);</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>product <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>            await _cache<span class="op">.</span><span class="fu">SetAsync</span><span class="op">(</span>$<span class="st">&quot;product:{id}&quot;</span><span class="op">,</span> product<span class="op">,</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">));</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> product<span class="op">;</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>æ”¯æŒæƒ…å†µ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å¤šçº§ç¼“å­˜</strong></td>
<td>âœ… Hybrid Provider</td>
</tr>
<tr>
<td><strong>å¤šåç«¯</strong></td>
<td>âœ… Memory/Redis/Memcached/SQLite</td>
</tr>
<tr>
<td><strong>AOP æ‹¦æˆª</strong></td>
<td>âœ… æ³¨è§£å¼ç¼“å­˜</td>
</tr>
<tr>
<td><strong>åºåˆ—åŒ–</strong></td>
<td>âœ… å¤šç§å¯é€‰</td>
</tr>
<tr>
<td><strong>å“åº”ç¼“å­˜</strong></td>
<td>âœ… æ”¯æŒ</td>
</tr>
</tbody>
</table>
<h3 id="cachemanager">3.4 CacheManager</h3>
<p><strong>åŒ…</strong>: <code>CacheManager.Core</code></p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// é…ç½®</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> cache <span class="op">=</span> CacheFactory<span class="op">.</span><span class="fu">Build</span><span class="op">&lt;</span>Product<span class="op">&gt;(</span>settings <span class="op">=&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    settings</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">WithSystemRuntimeCacheHandle</span><span class="op">(</span><span class="st">&quot;memory&quot;</span><span class="op">)</span>  <span class="co">// L1</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">And</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">WithRedisConfiguration</span><span class="op">(</span><span class="st">&quot;redis&quot;</span><span class="op">,</span> config <span class="op">=&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            config<span class="op">.</span><span class="fu">WithEndpoint</span><span class="op">(</span><span class="st">&quot;localhost&quot;</span><span class="op">,</span> <span class="dv">6379</span><span class="op">);</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">})</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">WithRedisCacheHandle</span><span class="op">(</span><span class="st">&quot;redis&quot;</span><span class="op">);</span>  <span class="co">// L2</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="op">});</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">// ä½¿ç”¨</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> product <span class="op">=</span> cache<span class="op">.</span><span class="fu">GetOrAdd</span><span class="op">(</span><span class="st">&quot;product:1&quot;</span><span class="op">,</span> key <span class="op">=&gt;</span> _repository<span class="op">.</span><span class="fu">GetById</span><span class="op">(</span><span class="dv">1</span><span class="op">));</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">// æ›´æ–°</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>cache<span class="op">.</span><span class="fu">Put</span><span class="op">(</span><span class="st">&quot;product:1&quot;</span><span class="op">,</span> updatedProduct<span class="op">);</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">// åˆ é™¤</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>cache<span class="op">.</span><span class="fu">Remove</span><span class="op">(</span><span class="st">&quot;product:1&quot;</span><span class="op">);</span></span></code></pre></div>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>æ”¯æŒæƒ…å†µ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å¤šçº§ç¼“å­˜</strong></td>
<td>âœ… å¤š Handle é“¾</td>
</tr>
<tr>
<td><strong>åç«¯æ”¯æŒ</strong></td>
<td>âœ… Memory/Redis/Memcached/Couchbase</td>
</tr>
<tr>
<td><strong>äº‹ä»¶ç³»ç»Ÿ</strong></td>
<td>âœ… OnAdd/OnRemove/OnUpdate</td>
</tr>
<tr>
<td><strong>åŒºåŸŸ(Region)</strong></td>
<td>âœ… æ”¯æŒ</td>
</tr>
<tr>
<td><strong>æ´»è·ƒåº¦</strong></td>
<td>âš ï¸ ç»´æŠ¤æ¨¡å¼</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="å¤šç»´åº¦æ¨ªå‘å¯¹æ¯”">4. å¤šç»´åº¦æ¨ªå‘å¯¹æ¯”</h2>
<h3 id="åŠŸèƒ½å¯¹æ¯”">4.1 åŠŸèƒ½å¯¹æ¯”</h3>
<table>
<colgroup>
<col style="width: 6%" />
<col style="width: 15%" />
<col style="width: 21%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 12%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th style="text-align: center;">IMemoryCache</th>
<th style="text-align: center;">IDistributedCache</th>
<th style="text-align: center;">HybridCache</th>
<th style="text-align: center;">FusionCache</th>
<th style="text-align: center;">LazyCache</th>
<th style="text-align: center;">EasyCaching</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æœ¬åœ°ç¼“å­˜</strong></td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td><strong>åˆ†å¸ƒå¼ç¼“å­˜</strong></td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td><strong>å¤šçº§ç¼“å­˜</strong></td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td><strong>é˜²å‡»ç©¿</strong></td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âŒ</td>
</tr>
<tr>
<td><strong>é˜²é›ªå´©(Jitter)</strong></td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
</tr>
<tr>
<td><strong>æ•…éšœå®‰å…¨</strong></td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
</tr>
<tr>
<td><strong>èƒŒæ¿åŒæ­¥</strong></td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td><strong>æ ‡ç­¾å¤±æ•ˆ</strong></td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
</tr>
<tr>
<td><strong>è‡ªåŠ¨åºåˆ—åŒ–</strong></td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td><strong>OpenTelemetry</strong></td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
</tr>
</tbody>
</table>
<h3 id="æ€§èƒ½å¯¹æ¯”">4.2 æ€§èƒ½å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>æ¡†æ¶</th>
<th style="text-align: center;">è¯»å–æ€§èƒ½</th>
<th style="text-align: center;">å†™å…¥æ€§èƒ½</th>
<th style="text-align: center;">å†…å­˜å ç”¨</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>IMemoryCache</strong></td>
<td style="text-align: center;">â­â­â­â­â­</td>
<td style="text-align: center;">â­â­â­â­â­</td>
<td style="text-align: center;">ä½</td>
<td>æœ€å¿«ï¼Œæ— é¢å¤–å¼€é”€</td>
</tr>
<tr>
<td><strong>IDistributedCache</strong></td>
<td style="text-align: center;">â­â­â­</td>
<td style="text-align: center;">â­â­â­</td>
<td style="text-align: center;">ä½</td>
<td>ç½‘ç»œå¼€é”€</td>
</tr>
<tr>
<td><strong>HybridCache</strong></td>
<td style="text-align: center;">â­â­â­â­</td>
<td style="text-align: center;">â­â­â­â­</td>
<td style="text-align: center;">ä¸­</td>
<td>L1 å‘½ä¸­å¿«</td>
</tr>
<tr>
<td><strong>FusionCache</strong></td>
<td style="text-align: center;">â­â­â­â­</td>
<td style="text-align: center;">â­â­â­â­</td>
<td style="text-align: center;">ä¸­</td>
<td>L1 å‘½ä¸­å¿«</td>
</tr>
<tr>
<td><strong>LazyCache</strong></td>
<td style="text-align: center;">â­â­â­â­â­</td>
<td style="text-align: center;">â­â­â­â­â­</td>
<td style="text-align: center;">ä½</td>
<td>å°è£… IMemoryCache</td>
</tr>
<tr>
<td><strong>EasyCaching</strong></td>
<td style="text-align: center;">â­â­â­â­</td>
<td style="text-align: center;">â­â­â­</td>
<td style="text-align: center;">ä¸­</td>
<td>åŠŸèƒ½å¤šï¼Œç•¥æ…¢</td>
</tr>
</tbody>
</table>
<h3 id="æ˜“ç”¨æ€§å¯¹æ¯”">4.3 æ˜“ç”¨æ€§å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>æ¡†æ¶</th>
<th style="text-align: center;">API ç®€æ´åº¦</th>
<th style="text-align: center;">å­¦ä¹ æ›²çº¿</th>
<th style="text-align: center;">æ–‡æ¡£è´¨é‡</th>
<th style="text-align: center;">ç¤¾åŒºæ´»è·ƒåº¦</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>IMemoryCache</strong></td>
<td style="text-align: center;">â­â­â­</td>
<td style="text-align: center;">ä½</td>
<td style="text-align: center;">â­â­â­â­â­</td>
<td style="text-align: center;">å®˜æ–¹</td>
</tr>
<tr>
<td><strong>IDistributedCache</strong></td>
<td style="text-align: center;">â­â­</td>
<td style="text-align: center;">ä½</td>
<td style="text-align: center;">â­â­â­â­</td>
<td style="text-align: center;">å®˜æ–¹</td>
</tr>
<tr>
<td><strong>HybridCache</strong></td>
<td style="text-align: center;">â­â­â­â­â­</td>
<td style="text-align: center;">ä½</td>
<td style="text-align: center;">â­â­â­â­</td>
<td style="text-align: center;">å®˜æ–¹(.NET 9)</td>
</tr>
<tr>
<td><strong>FusionCache</strong></td>
<td style="text-align: center;">â­â­â­â­â­</td>
<td style="text-align: center;">ä¸­</td>
<td style="text-align: center;">â­â­â­â­â­</td>
<td style="text-align: center;">â­â­â­â­â­</td>
</tr>
<tr>
<td><strong>LazyCache</strong></td>
<td style="text-align: center;">â­â­â­â­â­</td>
<td style="text-align: center;">å¾ˆä½</td>
<td style="text-align: center;">â­â­â­</td>
<td style="text-align: center;">â­â­â­</td>
</tr>
<tr>
<td><strong>EasyCaching</strong></td>
<td style="text-align: center;">â­â­â­</td>
<td style="text-align: center;">ä¸­</td>
<td style="text-align: center;">â­â­â­â­</td>
<td style="text-align: center;">â­â­â­â­</td>
</tr>
</tbody>
</table>
<h3 id="æ¡†æ¶é™åˆ¶å¯¹æ¯”">4.4 æ¡†æ¶é™åˆ¶å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>æ¡†æ¶</th>
<th>ä¸»è¦é™åˆ¶</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>IMemoryCache</strong></td>
<td>ä¸æ”¯æŒåˆ†å¸ƒå¼ï¼›æ— é˜²å‡»ç©¿ï¼›åº”ç”¨é‡å¯ä¸¢å¤±</td>
</tr>
<tr>
<td><strong>IDistributedCache</strong></td>
<td>API è¿‡äºç®€å•ï¼›éœ€æ‰‹åŠ¨åºåˆ—åŒ–ï¼›æ— é˜²å‡»ç©¿</td>
</tr>
<tr>
<td><strong>HybridCache</strong></td>
<td>ä»… .NET 9+ï¼›è¾ƒæ–°ï¼Œç”Ÿæ€å¾…å®Œå–„</td>
</tr>
<tr>
<td><strong>FusionCache</strong></td>
<td>é…ç½®é¡¹å¤šï¼Œéœ€è¦ç†è§£å„å‚æ•°å«ä¹‰</td>
</tr>
<tr>
<td><strong>LazyCache</strong></td>
<td>ä»…æœ¬åœ°ç¼“å­˜ï¼›åŠŸèƒ½ç›¸å¯¹ç®€å•</td>
</tr>
<tr>
<td><strong>EasyCaching</strong></td>
<td>é…ç½®å¤æ‚ï¼›éƒ¨åˆ†åŠŸèƒ½éœ€è¦å¤šä¸ªåŒ…</td>
</tr>
<tr>
<td><strong>CacheManager</strong></td>
<td>å·²è¿›å…¥ç»´æŠ¤æ¨¡å¼ï¼Œä¸æ¨èæ–°é¡¹ç›®ä½¿ç”¨</td>
</tr>
</tbody>
</table>
<h3 id="é€‚ç”¨åœºæ™¯">4.5 é€‚ç”¨åœºæ™¯</h3>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>æ¨èæ–¹æ¡ˆ</th>
<th>ç†ç”±</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ç®€å•æœ¬åœ°ç¼“å­˜</strong></td>
<td>IMemoryCache / LazyCache</td>
<td>è½»é‡ã€å®˜æ–¹æ”¯æŒ</td>
</tr>
<tr>
<td><strong>çº¯åˆ†å¸ƒå¼ç¼“å­˜</strong></td>
<td>IDistributedCache + Redis</td>
<td>æ ‡å‡†æ¥å£ã€æ˜“æ›¿æ¢</td>
</tr>
<tr>
<td><strong>ç”Ÿäº§çº§å¤šçº§ç¼“å­˜</strong></td>
<td>FusionCache</td>
<td>åŠŸèƒ½å®Œå–„ã€ä¹…ç»éªŒè¯</td>
</tr>
<tr>
<td><strong>.NET 9+ æ–°é¡¹ç›®</strong></td>
<td>HybridCache</td>
<td>å®˜æ–¹æ”¯æŒã€æ ‡ç­¾å¤±æ•ˆ</td>
</tr>
<tr>
<td><strong>éœ€è¦ AOP ç¼“å­˜</strong></td>
<td>EasyCaching</td>
<td>æ³¨è§£å¼ç¼“å­˜ã€æ‹¦æˆªå™¨</td>
</tr>
<tr>
<td><strong>å•ä½“åº”ç”¨å¿«é€Ÿå¼€å‘</strong></td>
<td>LazyCache</td>
<td>æç®€ API</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="é€‰å‹å†³ç­–æŒ‡å—">5. é€‰å‹å†³ç­–æŒ‡å—</h2>
<h3 id="å†³ç­–æ ‘">5.1 å†³ç­–æ ‘</h3>
<pre><code>ä½ çš„éœ€æ±‚æ˜¯ä»€ä¹ˆï¼Ÿ
â”‚
â”œâ”€â”€ ä»…éœ€æœ¬åœ°ç¼“å­˜ï¼Ÿ
â”‚   â”œâ”€â”€ éœ€è¦æç®€ APIï¼Ÿ â†’ LazyCache
â”‚   â””â”€â”€ æ ‡å‡†å®˜æ–¹æ–¹æ¡ˆï¼Ÿ â†’ IMemoryCache
â”‚
â”œâ”€â”€ éœ€è¦åˆ†å¸ƒå¼ç¼“å­˜ï¼Ÿ
â”‚   â”œâ”€â”€ ä»…åˆ†å¸ƒå¼ï¼Œæ— å¤šçº§ï¼Ÿ â†’ IDistributedCache + Redis
â”‚   â””â”€â”€ éœ€è¦å¤šçº§ç¼“å­˜ï¼Ÿ
â”‚       â”œâ”€â”€ .NET 9+ï¼Ÿ â†’ HybridCache
â”‚       â””â”€â”€ .NET 8 åŠä»¥ä¸‹ï¼Ÿ â†’ FusionCache
â”‚
â”œâ”€â”€ éœ€è¦é«˜å¯ç”¨/é˜²å‡»ç©¿/æ•…éšœå®‰å…¨ï¼Ÿ
â”‚   â””â”€â”€ FusionCacheï¼ˆæœ€å®Œå–„ï¼‰
â”‚
â”œâ”€â”€ éœ€è¦å¤šå®ä¾‹ç¼“å­˜åŒæ­¥ï¼Ÿ
â”‚   â”œâ”€â”€ FusionCache + Backplane
â”‚   â””â”€â”€ EasyCaching + Redis Bus
â”‚
â””â”€â”€ éœ€è¦ AOP æ³¨è§£å¼ç¼“å­˜ï¼Ÿ
    â””â”€â”€ EasyCaching</code></pre>
<h3 id="ç‰ˆæœ¬å…¼å®¹æ€§">5.2 ç‰ˆæœ¬å…¼å®¹æ€§</h3>
<table>
<thead>
<tr>
<th>æ¡†æ¶</th>
<th>æœ€ä½ .NET ç‰ˆæœ¬</th>
<th>æ¨èç‰ˆæœ¬</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>IMemoryCache</strong></td>
<td>.NET Standard 2.0</td>
<td>ä»»æ„</td>
</tr>
<tr>
<td><strong>IDistributedCache</strong></td>
<td>.NET Standard 2.0</td>
<td>ä»»æ„</td>
</tr>
<tr>
<td><strong>HybridCache</strong></td>
<td>.NET 9</td>
<td>.NET 9+</td>
</tr>
<tr>
<td><strong>FusionCache</strong></td>
<td>.NET Standard 2.0</td>
<td>.NET 6+</td>
</tr>
<tr>
<td><strong>LazyCache</strong></td>
<td>.NET Standard 2.0</td>
<td>ä»»æ„</td>
</tr>
<tr>
<td><strong>EasyCaching</strong></td>
<td>.NET Standard 2.0</td>
<td>.NET 6+</td>
</tr>
</tbody>
</table>
<h3 id="nuget-åŒ…æ¸…å•">5.3 NuGet åŒ…æ¸…å•</h3>
<div class="sourceCode" id="cb11"><pre
class="sourceCode xml"><code class="sourceCode xml"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- å¾®è½¯å®˜æ–¹ --&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">&quot;Microsoft.Extensions.Caching.Memory&quot;</span><span class="ot"> Version=</span><span class="st">&quot;8.0.0&quot;</span> /&gt;</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">&quot;Microsoft.Extensions.Caching.StackExchangeRedis&quot;</span><span class="ot"> Version=</span><span class="st">&quot;8.0.0&quot;</span> /&gt;</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">&quot;Microsoft.Extensions.Caching.Hybrid&quot;</span><span class="ot"> Version=</span><span class="st">&quot;9.0.0&quot;</span> /&gt; <span class="co">&lt;!-- .NET 9 --&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- FusionCache --&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">&quot;ZiggyCreatures.FusionCache&quot;</span><span class="ot"> Version=</span><span class="st">&quot;1.2.0&quot;</span> /&gt;</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">&quot;ZiggyCreatures.FusionCache.Serialization.SystemTextJson&quot;</span><span class="ot"> Version=</span><span class="st">&quot;1.2.0&quot;</span> /&gt;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">&quot;ZiggyCreatures.FusionCache.Backplane.StackExchangeRedis&quot;</span><span class="ot"> Version=</span><span class="st">&quot;1.2.0&quot;</span> /&gt;</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- LazyCache --&gt;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">&quot;LazyCache&quot;</span><span class="ot"> Version=</span><span class="st">&quot;2.4.0&quot;</span> /&gt;</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">&quot;LazyCache.AspNetCore&quot;</span><span class="ot"> Version=</span><span class="st">&quot;2.4.0&quot;</span> /&gt;</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- EasyCaching --&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">&quot;EasyCaching.Core&quot;</span><span class="ot"> Version=</span><span class="st">&quot;1.9.2&quot;</span> /&gt;</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">&quot;EasyCaching.InMemory&quot;</span><span class="ot"> Version=</span><span class="st">&quot;1.9.2&quot;</span> /&gt;</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">&quot;EasyCaching.Redis&quot;</span><span class="ot"> Version=</span><span class="st">&quot;1.9.2&quot;</span> /&gt;</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">PackageReference</span><span class="ot"> Include=</span><span class="st">&quot;EasyCaching.HybridCache&quot;</span><span class="ot"> Version=</span><span class="st">&quot;1.9.2&quot;</span> /&gt;</span></code></pre></div>
<hr />
<h2 id="æœ€ä½³å®è·µç¤ºä¾‹">6. æœ€ä½³å®è·µç¤ºä¾‹</h2>
<h3 id="ç”Ÿäº§çº§é…ç½®fusioncache">6.1 ç”Ÿäº§çº§é…ç½®ï¼ˆFusionCacheï¼‰</h3>
<div class="sourceCode" id="cb12"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">static</span> <span class="kw">class</span> CacheConfiguration</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> IServiceCollection <span class="fu">AddProductionCache</span><span class="op">(</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span> IServiceCollection services<span class="op">,</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        IConfiguration configuration<span class="op">)</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">var</span> redisConnection <span class="op">=</span> configuration<span class="op">.</span><span class="fu">GetConnectionString</span><span class="op">(</span><span class="st">&quot;Redis&quot;</span><span class="op">);</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        services<span class="op">.</span><span class="fu">AddFusionCache</span><span class="op">()</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">WithDefaultEntryOptions</span><span class="op">(</span><span class="kw">new</span> FusionCacheEntryOptions</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                <span class="co">// é»˜è®¤ç¼“å­˜æ—¶é—´</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                Duration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                <span class="co">// æ•…éšœå®‰å…¨ï¼šRedis ä¸å¯ç”¨æ—¶è¿”å›è¿‡æœŸæ•°æ®</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                IsFailSafeEnabled <span class="op">=</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>                FailSafeMaxDuration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromDays</span><span class="op">(</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>                FailSafeThrottleDuration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromSeconds</span><span class="op">(</span><span class="dv">30</span><span class="op">),</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>                <span class="co">// é˜²å‡»ç©¿ï¼šè½¯è¶…æ—¶åè¿”å›æ—§æ•°æ®ï¼Œåå°ç»§ç»­åŠ è½½</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>                FactorySoftTimeout <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromMilliseconds</span><span class="op">(</span><span class="dv">100</span><span class="op">),</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>                FactoryHardTimeout <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromSeconds</span><span class="op">(</span><span class="dv">2</span><span class="op">),</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>                <span class="co">// é˜²é›ªå´©ï¼šéšæœºæŠ–åŠ¨</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>                JitterMaxDuration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromMinutes</span><span class="op">(</span><span class="dv">2</span><span class="op">),</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>                <span class="co">// åå°æ“ä½œ</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>                AllowBackgroundDistributedCacheOperations <span class="op">=</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>                AllowBackgroundBackplaneOperations <span class="op">=</span> <span class="kw">true</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">})</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>            <span class="co">// L2 ç¼“å­˜</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">WithDistributedCache</span><span class="op">(</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>                <span class="kw">new</span> <span class="fu">RedisCache</span><span class="op">(</span><span class="kw">new</span> RedisCacheOptions <span class="op">{</span> Configuration <span class="op">=</span> redisConnection <span class="op">}))</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>            <span class="co">// åºåˆ—åŒ–</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">WithSerializer</span><span class="op">(</span><span class="kw">new</span> <span class="fu">FusionCacheSystemTextJsonSerializer</span><span class="op">())</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>            <span class="co">// èƒŒæ¿ï¼šå¤šå®ä¾‹åŒæ­¥</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">WithBackplane</span><span class="op">(</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>                <span class="kw">new</span> <span class="fu">RedisBackplane</span><span class="op">(</span><span class="kw">new</span> RedisBackplaneOptions <span class="op">{</span> Configuration <span class="op">=</span> redisConnection <span class="op">}))</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>            <span class="co">// OpenTelemetry</span></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">WithRegisteredLogger</span><span class="op">();</span></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> services<span class="op">;</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="ç”Ÿäº§çº§é…ç½®hybridcache-.net-9">6.2 ç”Ÿäº§çº§é…ç½®ï¼ˆHybridCache .NET
9ï¼‰</h3>
<div class="sourceCode" id="cb13"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">static</span> <span class="kw">class</span> CacheConfiguration</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> IServiceCollection <span class="fu">AddProductionHybridCache</span><span class="op">(</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span> IServiceCollection services<span class="op">,</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        IConfiguration configuration<span class="op">)</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// L2: Redis</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        services<span class="op">.</span><span class="fu">AddStackExchangeRedisCache</span><span class="op">(</span>options <span class="op">=&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>            options<span class="op">.</span><span class="fu">Configuration</span> <span class="op">=</span> configuration<span class="op">.</span><span class="fu">GetConnectionString</span><span class="op">(</span><span class="st">&quot;Redis&quot;</span><span class="op">);</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// HybridCache</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        services<span class="op">.</span><span class="fu">AddHybridCache</span><span class="op">(</span>options <span class="op">=&gt;</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>            options<span class="op">.</span><span class="fu">DefaultEntryOptions</span> <span class="op">=</span> <span class="kw">new</span> HybridCacheEntryOptions</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>                Expiration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromHours</span><span class="op">(</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                LocalCacheExpiration <span class="op">=</span> TimeSpan<span class="op">.</span><span class="fu">FromMinutes</span><span class="op">(</span><span class="dv">5</span><span class="op">),</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>                Flags <span class="op">=</span> HybridCacheEntryFlags<span class="op">.</span><span class="fu">DisableUnderlyingData</span> <span class="co">// å¯é€‰ï¼šç¦ç”¨æŸäº›åŠŸèƒ½</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>            options<span class="op">.</span><span class="fu">MaximumKeyLength</span> <span class="op">=</span> <span class="dv">512</span><span class="op">;</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>            options<span class="op">.</span><span class="fu">MaximumPayloadBytes</span> <span class="op">=</span> <span class="dv">1024</span> <span class="op">*</span> <span class="dv">1024</span><span class="op">;</span> <span class="co">// 1MB</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">});</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> services<span class="op">;</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 id="ç¼“å­˜æœåŠ¡å°è£…">6.3 ç¼“å­˜æœåŠ¡å°è£…</h3>
<div class="sourceCode" id="cb14"><pre
class="sourceCode csharp"><code class="sourceCode cs"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> ICacheService</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    Task<span class="op">&lt;</span>T<span class="op">?&gt;</span> GetOrSetAsync<span class="op">&lt;</span>T<span class="op">&gt;(</span><span class="dt">string</span> key<span class="op">,</span> Func<span class="op">&lt;</span>CancellationToken<span class="op">,</span> Task<span class="op">&lt;</span>T<span class="op">?&gt;&gt;</span> factory<span class="op">,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>        TimeSpan<span class="op">?</span> duration <span class="op">=</span> <span class="kw">null</span><span class="op">,</span> CancellationToken ct <span class="op">=</span> <span class="kw">default</span><span class="op">);</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    Task <span class="fu">RemoveAsync</span><span class="op">(</span><span class="dt">string</span> key<span class="op">,</span> CancellationToken ct <span class="op">=</span> <span class="kw">default</span><span class="op">);</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    Task <span class="fu">RemoveByPrefixAsync</span><span class="op">(</span><span class="dt">string</span> prefix<span class="op">,</span> CancellationToken ct <span class="op">=</span> <span class="kw">default</span><span class="op">);</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> FusionCacheService <span class="op">:</span> ICacheService</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> IFusionCache _cache<span class="op">;</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="kw">readonly</span> ILogger<span class="op">&lt;</span>FusionCacheService<span class="op">&gt;</span> _logger<span class="op">;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">FusionCacheService</span><span class="op">(</span>IFusionCache cache<span class="op">,</span> ILogger<span class="op">&lt;</span>FusionCacheService<span class="op">&gt;</span> logger<span class="op">)</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        _cache <span class="op">=</span> cache<span class="op">;</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        _logger <span class="op">=</span> logger<span class="op">;</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task<span class="op">&lt;</span>T<span class="op">?&gt;</span> GetOrSetAsync<span class="op">&lt;</span>T<span class="op">&gt;(</span><span class="dt">string</span> key<span class="op">,</span> Func<span class="op">&lt;</span>CancellationToken<span class="op">,</span> Task<span class="op">&lt;</span>T<span class="op">?&gt;&gt;</span> factory<span class="op">,</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>        TimeSpan<span class="op">?</span> duration <span class="op">=</span> <span class="kw">null</span><span class="op">,</span> CancellationToken ct <span class="op">=</span> <span class="kw">default</span><span class="op">)</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> await _cache<span class="op">.</span><span class="fu">GetOrSetAsync</span><span class="op">(</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>            key<span class="op">,</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>            factory<span class="op">,</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>            duration<span class="op">.</span><span class="fu">HasValue</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>                <span class="op">?</span> <span class="kw">new</span> FusionCacheEntryOptions <span class="op">{</span> Duration <span class="op">=</span> duration<span class="op">.</span><span class="fu">Value</span> <span class="op">}</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>                <span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>            ct</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task <span class="fu">RemoveAsync</span><span class="op">(</span><span class="dt">string</span> key<span class="op">,</span> CancellationToken ct <span class="op">=</span> <span class="kw">default</span><span class="op">)</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>        await _cache<span class="op">.</span><span class="fu">RemoveAsync</span><span class="op">(</span>key<span class="op">,</span> token<span class="op">:</span> ct<span class="op">);</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>        _logger<span class="op">.</span><span class="fu">LogDebug</span><span class="op">(</span><span class="st">&quot;Cache removed: {Key}&quot;</span><span class="op">,</span> key<span class="op">);</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> async Task <span class="fu">RemoveByPrefixAsync</span><span class="op">(</span><span class="dt">string</span> prefix<span class="op">,</span> CancellationToken ct <span class="op">=</span> <span class="kw">default</span><span class="op">)</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>        <span class="co">// FusionCache ä¸ç›´æ¥æ”¯æŒå‰ç¼€åˆ é™¤</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>        <span class="co">// éœ€è¦ç»“åˆ Redis SCAN å‘½ä»¤æˆ–ä½¿ç”¨æ ‡ç­¾</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>        _logger<span class="op">.</span><span class="fu">LogWarning</span><span class="op">(</span><span class="st">&quot;RemoveByPrefix not implemented for FusionCache&quot;</span><span class="op">);</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h2 id="æ€»ç»“">7. æ€»ç»“</h2>
<h3 id="æ¨èæ–¹æ¡ˆ">æ¨èæ–¹æ¡ˆ</h3>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>é¦–é€‰</th>
<th>å¤‡é€‰</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æ–°é¡¹ç›® (.NET 9+)</strong></td>
<td>HybridCache</td>
<td>FusionCache</td>
</tr>
<tr>
<td><strong>ç°æœ‰é¡¹ç›® (.NET 6/7/8)</strong></td>
<td>FusionCache</td>
<td>EasyCaching</td>
</tr>
<tr>
<td><strong>ç®€å•æœ¬åœ°ç¼“å­˜</strong></td>
<td>LazyCache</td>
<td>IMemoryCache</td>
</tr>
<tr>
<td><strong>ä»…åˆ†å¸ƒå¼ç¼“å­˜</strong></td>
<td>IDistributedCache + Redis</td>
<td>-</td>
</tr>
<tr>
<td><strong>éœ€è¦ AOP</strong></td>
<td>EasyCaching</td>
<td>-</td>
</tr>
<tr>
<td><strong>ä¼ä¸šçº§/é«˜å¯ç”¨</strong></td>
<td>FusionCache</td>
<td>NCache</td>
</tr>
</tbody>
</table>
<h3 id="æ ¸å¿ƒè¦ç‚¹">æ ¸å¿ƒè¦ç‚¹</h3>
<ol type="1">
<li><strong>å®˜æ–¹æ–¹æ¡ˆè¶‹åŠ¿</strong>ï¼šHybridCache æ˜¯å¾®è½¯çš„æœªæ¥æ–¹å‘ï¼Œ.NET 9+
é¡¹ç›®é¦–é€‰</li>
<li><strong>æˆç†Ÿç¨³å®š</strong>ï¼šFusionCache åŠŸèƒ½æœ€å®Œå–„ï¼Œç”Ÿäº§ç¯å¢ƒé¦–é€‰</li>
<li><strong>ç®€å•åœºæ™¯</strong>ï¼šLazyCache æˆ– IMemoryCache è¶³å¤Ÿ</li>
<li><strong>é¿å…è¿‡åº¦è®¾è®¡</strong>ï¼šæ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©ï¼Œä¸è¦ä¸ºäº†â€å®Œå–„â€è€Œå¼•å…¥å¤æ‚æ€§</li>
</ol>
<h3 id="å‚è€ƒèµ„æº">å‚è€ƒèµ„æº</h3>
<ul>
<li><a
href="https://learn.microsoft.com/en-us/aspnet/core/performance/caching">Microsoft
Caching Documentation</a></li>
<li><a
href="https://learn.microsoft.com/en-us/aspnet/core/performance/caching/hybrid">HybridCache
in .NET 9</a></li>
<li><a href="https://github.com/ZiggyCreatures/FusionCache">FusionCache
GitHub</a></li>
<li><a href="https://github.com/dotnetcore/EasyCaching">EasyCaching
GitHub</a></li>
<li><a href="https://github.com/alastairtree/LazyCache">LazyCache
GitHub</a></li>
</ul>

                </article>
            </div>
        </section>

        <!-- å³ä¾§çƒ­é—¨æ–‡ç«  -->
        <aside class="popular-sidebar">
            <div class="popular-header">
                <h3>çƒ­é—¨æ–‡ç« </h3>
            </div>
            <div class="popular-list" id="popular-list">
                <!-- åŠ¨æ€ç”Ÿæˆçš„çƒ­é—¨æ–‡ç« åˆ—è¡¨ -->
            </div>
        </aside>
    </main>

    <!-- JavaScript -->
    <script src="/script.js?v=2.1.2"></script>
</body>
</html>