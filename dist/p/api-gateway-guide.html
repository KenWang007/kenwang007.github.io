<!DOCTYPE html>
<html lang="zh-CN" class="page-article">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ğŸšª API ç½‘å…³è®¾è®¡æŒ‡å— - å…³é”®è¯: API, ç½‘å…³è®¾è®¡æŒ‡å—">
    <meta name="keywords" content="API, ç½‘å…³è®¾è®¡æŒ‡å—">
    <meta name="author" content="Ken Wang">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://kenwang007.github.io/dist/p/api-gateway-guide.html">
    <meta property="og:title" content="ğŸšª API ç½‘å…³è®¾è®¡æŒ‡å— - Kençš„çŸ¥è¯†åº“">
    <meta property="og:description" content="ğŸšª API ç½‘å…³è®¾è®¡æŒ‡å— - å…³é”®è¯: API, ç½‘å…³è®¾è®¡æŒ‡å—">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary">
    <meta property="twitter:url" content="https://kenwang007.github.io/dist/p/api-gateway-guide.html">
    <meta property="twitter:title" content="ğŸšª API ç½‘å…³è®¾è®¡æŒ‡å— - Kençš„çŸ¥è¯†åº“">
    <meta property="twitter:description" content="ğŸšª API ç½‘å…³è®¾è®¡æŒ‡å— - å…³é”®è¯: API, ç½‘å…³è®¾è®¡æŒ‡å—">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#6366f1">
    
    <title>ğŸšª API ç½‘å…³è®¾è®¡æŒ‡å— - Kençš„çŸ¥è¯†åº“</title>
    <link rel="stylesheet" href="/style.css?v=2.1.2">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22 fill=%22%236366f1%22>ğŸ“š</text></svg>">
    <link rel="canonical" href="https://kenwang007.github.io/dist/p/api-gateway-guide.html">
    <link rel="manifest" href="/manifest.json">
    
    <!-- Highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- RSS Feed -->
    <link rel="alternate" type="application/rss+xml" title="Kençš„çŸ¥è¯†åº“ RSS Feed" href="/rss.xml">
    
    <!-- Breadcrumb Navigation -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "é¦–é¡µ",
          "item": "https://kenwang007.github.io/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "ğŸšª API ç½‘å…³è®¾è®¡æŒ‡å—",
          "item": "https://kenwang007.github.io/dist/p/api-gateway-guide.html"
        }
      ]
    }
    </script>
    
    <!-- Article Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "ğŸšª API ç½‘å…³è®¾è®¡æŒ‡å—",
      "description": "ğŸšª API ç½‘å…³è®¾è®¡æŒ‡å— - å…³é”®è¯: API, ç½‘å…³è®¾è®¡æŒ‡å—",
      "author": {
        "@type": "Person",
        "name": "Ken Wang"
      },
      "datePublished": "2026-01-31T15:35:02.718365",
      "dateModified": "2026-01-29T20:26:18.620897",
      "inLanguage": "zh-CN"
    }
    </script>
</head>
<body>
    <!-- æ˜Ÿç©ºèƒŒæ™¯ -->
    <div class="stars"></div>
    <div class="stars2"></div>
    <div class="stars3"></div>

    <!-- é¡¶éƒ¨å›ºå®šå¯¼èˆª -->
    <header class="top-nav">
        <div class="nav-container">
            <div class="logo">
                <a href="/index.html">
                    <span class="logo-text">ğŸ“š Kençš„çŸ¥è¯†åº“</span>
                </a>
            </div>
            <nav class="main-nav">
                <ul id="nav-menu" class="nav-menu">
                    <!-- åŠ¨æ€ç”Ÿæˆçš„å¯¼èˆªèœå•é¡¹ -->
                </ul>
            </nav>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
        <!-- å·¦ä¾§å›ºå®šå…³é”®è¯ç´¢å¼• -->
        <aside class="keyword-sidebar">
            <div class="keyword-header">
                <h3>å…³é”®è¯ç´¢å¼•</h3>
            </div>
            <div class="keyword-list" id="keyword-list">
                <!-- åŠ¨æ€ç”Ÿæˆçš„å…³é”®è¯ -->
            </div>
        </aside>

        <!-- ä¸­é—´ä¸»å†…å®¹ -->
        <section class="content-area">
            <div class="content-wrapper">
                <article class="markdown-content">
                    
<h1 id="api-ç½‘å…³è®¾è®¡æŒ‡å—">ğŸšª API ç½‘å…³è®¾è®¡æŒ‡å—</h1>
<h2 id="ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³">1. ä¸ºä»€ä¹ˆéœ€è¦ç½‘å…³ï¼Ÿ</h2>
<h3 id="æ²¡æœ‰ç½‘å…³çš„é—®é¢˜">1.1 æ²¡æœ‰ç½‘å…³çš„é—®é¢˜</h3>
<pre><code>ä¼ ç»Ÿæ¶æ„ï¼ˆæ— ç½‘å…³ï¼‰ï¼š

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Client  â”‚â”€â”€â”€â”€â†’â”‚  Service A  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  Service B  â”‚
         â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  Service C  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜ï¼š
â€¢ å®¢æˆ·ç«¯éœ€è¦çŸ¥é“æ‰€æœ‰æœåŠ¡åœ°å€
â€¢ æ¯ä¸ªæœåŠ¡éƒ½è¦å®ç°è®¤è¯ã€é™æµã€æ—¥å¿—
â€¢ è·¨åŸŸã€åè®®è½¬æ¢ç­‰é‡å¤å¤„ç†
â€¢ æœåŠ¡å˜æ›´å®¢æˆ·ç«¯éœ€è¦åŒæ­¥ä¿®æ”¹
â€¢ å®‰å…¨è¾¹ç•Œæ¨¡ç³Šï¼Œæ”»å‡»é¢å¤§</pre>
<h3 id="ç½‘å…³è§£å†³çš„æ ¸å¿ƒé—®é¢˜">1.2 ç½‘å…³è§£å†³çš„æ ¸å¿ƒé—®é¢˜</h3>
<table>
<thead>
<tr>
<th>é—®é¢˜</th>
<th>ç½‘å…³è§£å†³æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ç»Ÿä¸€å…¥å£</strong></td>
<td>å•ä¸€è®¿é—®ç‚¹ï¼Œå±è”½åç«¯å¤æ‚æ€§</td>
</tr>
<tr>
<td><strong>å®‰å…¨è¾¹ç•Œ</strong></td>
<td>é›†ä¸­è®¤è¯æˆæƒï¼Œå‡å°‘æ”»å‡»é¢</td>
</tr>
<tr>
<td><strong>æµé‡ç®¡æ§</strong></td>
<td>é™æµã€ç†”æ–­ã€è´Ÿè½½å‡è¡¡</td>
</tr>
<tr>
<td><strong>åè®®è½¬æ¢</strong></td>
<td>HTTP/gRPC/WebSocket äº’è½¬</td>
</tr>
<tr>
<td><strong>è¯·æ±‚èšåˆ</strong></td>
<td>BFF æ¨¡å¼ï¼Œå‡å°‘å®¢æˆ·ç«¯è¯·æ±‚æ¬¡æ•°</td>
</tr>
<tr>
<td><strong>ç›‘æ§å®¡è®¡</strong></td>
<td>ç»Ÿä¸€æ—¥å¿—ã€é“¾è·¯è¿½è¸ªã€æŒ‡æ ‡é‡‡é›†</td>
</tr>
<tr>
<td><strong>ç°åº¦å‘å¸ƒ</strong></td>
<td>æŒ‰è§„åˆ™è·¯ç”±åˆ°ä¸åŒç‰ˆæœ¬</td>
</tr>
</tbody>
</table>
<h3 id="ç½‘å…³æ¶æ„">1.3 ç½‘å…³æ¶æ„</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API Gateway                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  è®¤è¯   â”‚ â”‚  é™æµ   â”‚ â”‚  è·¯ç”±   â”‚ â”‚  ç›‘æ§   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  ç¼“å­˜   â”‚ â”‚  ç†”æ–­   â”‚ â”‚  è½¬æ¢   â”‚ â”‚  æ—¥å¿—   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service A  â”‚ â”‚  Service B  â”‚ â”‚  Service C  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
<hr />
<h2 id="ç½‘å…³åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨">2. ç½‘å…³åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„åº”ç”¨</h2>
<h3 id="æ ¸å¿ƒåŠŸèƒ½">2.1 æ ¸å¿ƒåŠŸèƒ½</h3>
<h4 id="è·¯ç”±ä¸è´Ÿè½½å‡è¡¡">è·¯ç”±ä¸è´Ÿè½½å‡è¡¡</h4>
<pre><code class="language-csharp">// YARP è·¯ç”±é…ç½®ç¤ºä¾‹
{
  &quot;ReverseProxy&quot;: {
    &quot;Routes&quot;: {
      &quot;orders-route&quot;: {
        &quot;ClusterId&quot;: &quot;orders-cluster&quot;,
        &quot;Match&quot;: { &quot;Path&quot;: &quot;/api/orders/{**catch-all}&quot; }
      },
      &quot;users-route&quot;: {
        &quot;ClusterId&quot;: &quot;users-cluster&quot;,
        &quot;Match&quot;: { &quot;Path&quot;: &quot;/api/users/{**catch-all}&quot; }
      }
    },
    &quot;Clusters&quot;: {
      &quot;orders-cluster&quot;: {
        &quot;LoadBalancingPolicy&quot;: &quot;RoundRobin&quot;,
        &quot;Destinations&quot;: {
          &quot;d1&quot;: { &quot;Address&quot;: &quot;http://orders-service-1:5000&quot; },
          &quot;d2&quot;: { &quot;Address&quot;: &quot;http://orders-service-2:5000&quot; }
        }
      }
    }
  }
}</pre>
<h4 id="è®¤è¯ä¸æˆæƒ">è®¤è¯ä¸æˆæƒ</h4>
<pre><code class="language-csharp">// JWT è®¤è¯ä¸­é—´ä»¶
builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer(options =&gt;
    {
        options.Authority = &quot;https://identity-server&quot;;
        options.Audience = &quot;api-gateway&quot;;
    });

// ç½‘å…³ç»Ÿä¸€éªŒè¯ï¼Œä¸‹æ¸¸æœåŠ¡ä¿¡ä»»ç½‘å…³
app.UseAuthentication();
app.UseAuthorization();</pre>
<h4 id="é™æµä¸ç†”æ–­">é™æµä¸ç†”æ–­</h4>
<pre><code class="language-csharp">// ä½¿ç”¨ Polly å®ç°ç†”æ–­
builder.Services.AddReverseProxy()
    .LoadFromConfig(builder.Configuration.GetSection(&quot;ReverseProxy&quot;))
    .AddTransforms(context =&gt;
    {
        context.AddRequestTransform(async transformContext =&gt;
        {
            // æ·»åŠ é™æµé€»è¾‘
            await _rateLimiter.WaitAsync(transformContext.HttpContext.RequestAborted);
        });
    });</pre>
<h4 id="è¯·æ±‚èšåˆbff-æ¨¡å¼">è¯·æ±‚èšåˆï¼ˆBFF æ¨¡å¼ï¼‰</h4>
<pre><code class="language-csharp">// GraphQL èšåˆå¤šä¸ªæœåŠ¡
public class Query
{
    public async Task&lt;OrderWithUser&gt; GetOrderDetail(
        [Service] IOrderService orderService,
        [Service] IUserService userService,
        int orderId)
    {
        var order = await orderService.GetOrderAsync(orderId);
        var user = await userService.GetUserAsync(order.UserId);
        
        return new OrderWithUser { Order = order, User = user };
    }
}</pre>
<h3 id="å¸¸è§æ¶æ„æ¨¡å¼">2.2 å¸¸è§æ¶æ„æ¨¡å¼</h3>
<h4 id="å•ä¸€ç½‘å…³">å•ä¸€ç½‘å…³</h4>
<pre><code>é€‚ç”¨ï¼šä¸­å°å‹ç³»ç»Ÿ
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Gateway  â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼         â–¼
  Users    Orders    Products</pre>
<h4 id="å¤šç½‘å…³æŒ‰å®¢æˆ·ç«¯åˆ†">å¤šç½‘å…³ï¼ˆæŒ‰å®¢æˆ·ç«¯åˆ†ï¼‰</h4>
<pre><code>é€‚ç”¨ï¼šå¤šç«¯åº”ç”¨ï¼ˆWeb/Mobile/ç¬¬ä¸‰æ–¹ï¼‰

  Web Client    Mobile App    Partner API
       â”‚             â”‚             â”‚
       â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Web GW   â”‚  â”‚Mobile GW â”‚  â”‚Partner GWâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
            Internal Services</pre>
<h4 id="ç½‘å…³-service-mesh">ç½‘å…³ + Service Mesh</h4>
<pre><code>é€‚ç”¨ï¼šå¤§å‹å¾®æœåŠ¡ç³»ç»Ÿ

Client â†’ API Gateway â†’ [Service Mesh (Istio/Linkerd)]
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼               â–¼               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚Sidecar â”‚      â”‚Sidecar â”‚      â”‚Sidecar â”‚
         â”‚   +    â”‚      â”‚   +    â”‚      â”‚   +    â”‚
         â”‚Service â”‚      â”‚Service â”‚      â”‚Service â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
<h3 id="ç½‘å…³-vs-service-mesh">2.3 ç½‘å…³ vs Service Mesh</h3>
<table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>API Gateway</th>
<th>Service Mesh</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>æµé‡å…¥å£</strong></td>
<td>âœ… å—åŒ—å‘æµé‡</td>
<td>âŒ ä¸»è¦ä¸œè¥¿å‘</td>
</tr>
<tr>
<td><strong>è®¤è¯æˆæƒ</strong></td>
<td>âœ… å¤–éƒ¨è®¤è¯</td>
<td>âœ… æœåŠ¡é—´ mTLS</td>
</tr>
<tr>
<td><strong>é™æµç†”æ–­</strong></td>
<td>âœ… å…¥å£çº§åˆ«</td>
<td>âœ… æœåŠ¡çº§åˆ«</td>
</tr>
<tr>
<td><strong>åè®®è½¬æ¢</strong></td>
<td>âœ…</td>
<td>âŒ</td>
</tr>
<tr>
<td><strong>è¯·æ±‚èšåˆ</strong></td>
<td>âœ…</td>
<td>âŒ</td>
</tr>
<tr>
<td><strong>å¯è§‚æµ‹æ€§</strong></td>
<td>âœ… å…¥å£çº§åˆ«</td>
<td>âœ… å…¨é“¾è·¯</td>
</tr>
<tr>
<td><strong>éƒ¨ç½²å¤æ‚åº¦</strong></td>
<td>ä½</td>
<td>é«˜</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="net-ç½‘å…³å®ç°æ–¹æ¡ˆ">3. .NET ç½‘å…³å®ç°æ–¹æ¡ˆ</h2>
<h3 id="æ–¹æ¡ˆæ¦‚è§ˆ">3.1 æ–¹æ¡ˆæ¦‚è§ˆ</h3>
<table>
<thead>
<tr>
<th>æ–¹æ¡ˆ</th>
<th>ç±»å‹</th>
<th>ç»´æŠ¤è€…</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>YARP</strong></td>
<td>åå‘ä»£ç†åº“</td>
<td>Microsoft</td>
<td>è‡ªå®šä¹‰ç½‘å…³</td>
</tr>
<tr>
<td><strong>Ocelot</strong></td>
<td>API ç½‘å…³æ¡†æ¶</td>
<td>å¼€æºç¤¾åŒº</td>
<td>å¿«é€Ÿæ­å»º</td>
</tr>
<tr>
<td><strong>Azure API Management</strong></td>
<td>äº‘æœåŠ¡</td>
<td>Microsoft</td>
<td>Azure éƒ¨ç½²</td>
</tr>
<tr>
<td><strong>Kong</strong></td>
<td>ç‹¬ç«‹ç½‘å…³</td>
<td>Kong Inc</td>
<td>å¤šè¯­è¨€ç¯å¢ƒ</td>
</tr>
<tr>
<td><strong>è‡ªç ”ï¼ˆASP.NET Coreï¼‰</strong></td>
<td>è‡ªå®šä¹‰</td>
<td>-</td>
<td>ç‰¹æ®Šéœ€æ±‚</td>
</tr>
</tbody>
</table>
<h3 id="yarpyet-another-reverse-proxy">3.2 YARPï¼ˆYet Another Reverse
Proxyï¼‰</h3>
<p><strong>åŒ…</strong>: <code>Yarp.ReverseProxy</code></p>
<pre><code class="language-csharp">// Program.cs
var builder = WebApplication.CreateBuilder(args);

builder.Services.AddReverseProxy()
    .LoadFromConfig(builder.Configuration.GetSection(&quot;ReverseProxy&quot;));

var app = builder.Build();
app.MapReverseProxy();
app.Run();</pre>
<p><strong>appsettings.json</strong>:</p>
<pre><code class="language-json">{
  &quot;ReverseProxy&quot;: {
    &quot;Routes&quot;: {
      &quot;api-route&quot;: {
        &quot;ClusterId&quot;: &quot;api-cluster&quot;,
        &quot;Match&quot;: { &quot;Path&quot;: &quot;/api/{**catch-all}&quot; },
        &quot;Transforms&quot;: [
          { &quot;PathRemovePrefix&quot;: &quot;/api&quot; }
        ]
      }
    },
    &quot;Clusters&quot;: {
      &quot;api-cluster&quot;: {
        &quot;LoadBalancingPolicy&quot;: &quot;RoundRobin&quot;,
        &quot;HealthCheck&quot;: {
          &quot;Active&quot;: {
            &quot;Enabled&quot;: true,
            &quot;Interval&quot;: &quot;00:00:10&quot;,
            &quot;Path&quot;: &quot;/health&quot;
          }
        },
        &quot;Destinations&quot;: {
          &quot;d1&quot;: { &quot;Address&quot;: &quot;http://backend-1:5000&quot; },
          &quot;d2&quot;: { &quot;Address&quot;: &quot;http://backend-2:5000&quot; }
        }
      }
    }
  }
}</pre>
<p><strong>è‡ªå®šä¹‰ä¸­é—´ä»¶</strong>:</p>
<pre><code class="language-csharp">builder.Services.AddReverseProxy()
    .LoadFromConfig(builder.Configuration.GetSection(&quot;ReverseProxy&quot;))
    .AddTransforms(context =&gt;
    {
        // æ·»åŠ è¯·æ±‚å¤´
        context.AddRequestHeader(&quot;X-Forwarded-Host&quot;, context.HttpContext.Request.Host.Value);
        
        // è‡ªå®šä¹‰è½¬æ¢
        context.AddRequestTransform(async transformContext =&gt;
        {
            var userId = transformContext.HttpContext.User.FindFirst(&quot;sub&quot;)?.Value;
            if (userId != null)
            {
                transformContext.ProxyRequest.Headers.Add(&quot;X-User-Id&quot;, userId);
            }
        });
    });</pre>
<h3 id="ocelot">3.3 Ocelot</h3>
<p><strong>åŒ…</strong>: <code>Ocelot</code></p>
<pre><code class="language-csharp">// Program.cs
var builder = WebApplication.CreateBuilder(args);

builder.Configuration.AddJsonFile(&quot;ocelot.json&quot;);
builder.Services.AddOcelot();

var app = builder.Build();
await app.UseOcelot();
app.Run();</pre>
<p><strong>ocelot.json</strong>:</p>
<pre><code class="language-json">{
  &quot;Routes&quot;: [
    {
      &quot;DownstreamPathTemplate&quot;: &quot;/api/users/{everything}&quot;,
      &quot;DownstreamScheme&quot;: &quot;http&quot;,
      &quot;DownstreamHostAndPorts&quot;: [
        { &quot;Host&quot;: &quot;users-service&quot;, &quot;Port&quot;: 5001 }
      ],
      &quot;UpstreamPathTemplate&quot;: &quot;/users/{everything}&quot;,
      &quot;UpstreamHttpMethod&quot;: [ &quot;Get&quot;, &quot;Post&quot;, &quot;Put&quot;, &quot;Delete&quot; ],
      &quot;AuthenticationOptions&quot;: {
        &quot;AuthenticationProviderKey&quot;: &quot;Bearer&quot;
      },
      &quot;RateLimitOptions&quot;: {
        &quot;EnableRateLimiting&quot;: true,
        &quot;Period&quot;: &quot;1s&quot;,
        &quot;Limit&quot;: 100
      }
    },
    {
      &quot;DownstreamPathTemplate&quot;: &quot;/api/orders/{everything}&quot;,
      &quot;DownstreamScheme&quot;: &quot;http&quot;,
      &quot;DownstreamHostAndPorts&quot;: [
        { &quot;Host&quot;: &quot;orders-service&quot;, &quot;Port&quot;: 5002 }
      ],
      &quot;UpstreamPathTemplate&quot;: &quot;/orders/{everything}&quot;,
      &quot;LoadBalancerOptions&quot;: {
        &quot;Type&quot;: &quot;RoundRobin&quot;
      }
    }
  ],
  &quot;GlobalConfiguration&quot;: {
    &quot;BaseUrl&quot;: &quot;https://api.example.com&quot;
  }
}</pre>
<p><strong>æœåŠ¡å‘ç°ï¼ˆConsulï¼‰</strong>:</p>
<pre><code class="language-csharp">builder.Services.AddOcelot()
    .AddConsul();</pre>
<pre><code class="language-json">{
  &quot;Routes&quot;: [
    {
      &quot;DownstreamPathTemplate&quot;: &quot;/api/{everything}&quot;,
      &quot;DownstreamScheme&quot;: &quot;http&quot;,
      &quot;UpstreamPathTemplate&quot;: &quot;/users/{everything}&quot;,
      &quot;ServiceName&quot;: &quot;users-service&quot;,
      &quot;LoadBalancerOptions&quot;: { &quot;Type&quot;: &quot;RoundRobin&quot; }
    }
  ],
  &quot;GlobalConfiguration&quot;: {
    &quot;ServiceDiscoveryProvider&quot;: {
      &quot;Scheme&quot;: &quot;http&quot;,
      &quot;Host&quot;: &quot;consul&quot;,
      &quot;Port&quot;: 8500,
      &quot;Type&quot;: &quot;Consul&quot;
    }
  }
}</pre>
<h3 id="è‡ªç ”ç½‘å…³asp.net-core">3.4 è‡ªç ”ç½‘å…³ï¼ˆASP.NET Coreï¼‰</h3>
<pre><code class="language-csharp">// ç®€å•åå‘ä»£ç†å®ç°
public class ProxyMiddleware
{
    private readonly RequestDelegate _next;
    private readonly IHttpClientFactory _clientFactory;
    private readonly IServiceDiscovery _discovery;
    
    public ProxyMiddleware(RequestDelegate next, IHttpClientFactory clientFactory, 
        IServiceDiscovery discovery)
    {
        _next = next;
        _clientFactory = clientFactory;
        _discovery = discovery;
    }
    
    public async Task InvokeAsync(HttpContext context)
    {
        var path = context.Request.Path.Value;
        
        // è·¯ç”±åŒ¹é…
        var service = ResolveService(path);
        if (service == null)
        {
            await _next(context);
            return;
        }
        
        // æœåŠ¡å‘ç°
        var endpoint = await _discovery.GetEndpointAsync(service);
        
        // è½¬å‘è¯·æ±‚
        var client = _clientFactory.CreateClient();
        var request = CreateProxyRequest(context, endpoint);
        var response = await client.SendAsync(request);
        
        // å¤åˆ¶å“åº”
        await CopyResponseAsync(context, response);
    }
    
    private HttpRequestMessage CreateProxyRequest(HttpContext context, string endpoint)
    {
        var request = new HttpRequestMessage
        {
            Method = new HttpMethod(context.Request.Method),
            RequestUri = new Uri($&quot;{endpoint}{context.Request.Path}{context.Request.QueryString}&quot;)
        };
        
        // å¤åˆ¶è¯·æ±‚å¤´
        foreach (var header in context.Request.Headers)
        {
            request.Headers.TryAddWithoutValidation(header.Key, header.Value.ToArray());
        }
        
        // å¤åˆ¶è¯·æ±‚ä½“
        if (context.Request.ContentLength &gt; 0)
        {
            request.Content = new StreamContent(context.Request.Body);
        }
        
        return request;
    }
}</pre>
<hr />
<h2 id="net-ç½‘å…³æ¡†æ¶å¯¹æ¯”">4. .NET ç½‘å…³æ¡†æ¶å¯¹æ¯”</h2>
<h3 id="åŠŸèƒ½å¯¹æ¯”">4.1 åŠŸèƒ½å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th style="text-align: center;">YARP</th>
<th style="text-align: center;">Ocelot</th>
<th style="text-align: center;">Azure APIM</th>
<th style="text-align: center;">Kong</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>è·¯ç”±</strong></td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td><strong>è´Ÿè½½å‡è¡¡</strong></td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td><strong>å¥åº·æ£€æŸ¥</strong></td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td><strong>é™æµ</strong></td>
<td style="text-align: center;">éœ€æ‰©å±•</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td><strong>ç†”æ–­</strong></td>
<td style="text-align: center;">éœ€æ‰©å±•</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td><strong>è®¤è¯</strong></td>
<td style="text-align: center;">éœ€é›†æˆ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td><strong>è¯·æ±‚èšåˆ</strong></td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">æ’ä»¶</td>
</tr>
<tr>
<td><strong>æœåŠ¡å‘ç°</strong></td>
<td style="text-align: center;">éœ€æ‰©å±•</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td><strong>ç¼“å­˜</strong></td>
<td style="text-align: center;">éœ€æ‰©å±•</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td><strong>WebSocket</strong></td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td><strong>gRPC</strong></td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
<tr>
<td><strong>ç®¡ç† UI</strong></td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âŒ</td>
<td style="text-align: center;">âœ…</td>
<td style="text-align: center;">âœ…</td>
</tr>
</tbody>
</table>
<h3 id="æ€§èƒ½å¯¹æ¯”">4.2 æ€§èƒ½å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>æŒ‡æ ‡</th>
<th style="text-align: center;">YARP</th>
<th style="text-align: center;">Ocelot</th>
<th style="text-align: center;">Kong</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ååé‡</strong></td>
<td style="text-align: center;">â­â­â­â­â­</td>
<td style="text-align: center;">â­â­â­</td>
<td style="text-align: center;">â­â­â­â­</td>
</tr>
<tr>
<td><strong>å»¶è¿Ÿ</strong></td>
<td style="text-align: center;">&lt; 1ms</td>
<td style="text-align: center;">2-5ms</td>
<td style="text-align: center;">1-2ms</td>
</tr>
<tr>
<td><strong>å†…å­˜å ç”¨</strong></td>
<td style="text-align: center;">ä½</td>
<td style="text-align: center;">ä¸­</td>
<td style="text-align: center;">é«˜</td>
</tr>
<tr>
<td><strong>CPU å ç”¨</strong></td>
<td style="text-align: center;">ä½</td>
<td style="text-align: center;">ä¸­</td>
<td style="text-align: center;">ä¸­</td>
</tr>
</tbody>
</table>
<blockquote>
<p>YARP æ˜¯ç›®å‰ .NET ç”Ÿæ€ä¸­æ€§èƒ½æœ€å¥½çš„æ–¹æ¡ˆï¼Œå¾®è½¯å†…éƒ¨æœåŠ¡å¤§é‡ä½¿ç”¨ã€‚</p>
</blockquote>
<h3 id="ä¼˜åŠ£åŠ¿å¯¹æ¯”">4.3 ä¼˜åŠ£åŠ¿å¯¹æ¯”</h3>
<h4 id="yarp">YARP</h4>
<table>
<thead>
<tr>
<th>ä¼˜åŠ¿</th>
<th>åŠ£åŠ¿</th>
</tr>
</thead>
<tbody>
<tr>
<td>âœ… å¾®è½¯å®˜æ–¹ç»´æŠ¤ï¼Œé•¿æœŸæ”¯æŒ</td>
<td>âŒ åŠŸèƒ½éœ€è¦è‡ªå·±æ‰©å±•</td>
</tr>
<tr>
<td>âœ… æ€§èƒ½æä½³</td>
<td>âŒ æ²¡æœ‰å†…ç½®é™æµ/ç†”æ–­</td>
</tr>
<tr>
<td>âœ… é«˜åº¦å¯å®šåˆ¶</td>
<td>âŒ å­¦ä¹ æ›²çº¿ç¨é«˜</td>
</tr>
<tr>
<td>âœ… æ”¯æŒ gRPC/WebSocket</td>
<td>âŒ æ— ç®¡ç†ç•Œé¢</td>
</tr>
<tr>
<td>âœ… ä¸ ASP.NET Core æ·±åº¦é›†æˆ</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="ocelot-1">Ocelot</h4>
<table>
<thead>
<tr>
<th>ä¼˜åŠ¿</th>
<th>åŠ£åŠ¿</th>
</tr>
</thead>
<tbody>
<tr>
<td>âœ… å¼€ç®±å³ç”¨ï¼ŒåŠŸèƒ½å®Œæ•´</td>
<td>âŒ æ€§èƒ½ä¸å¦‚ YARP</td>
</tr>
<tr>
<td>âœ… é…ç½®ç®€å•</td>
<td>âŒ ä¸æ”¯æŒ gRPC</td>
</tr>
<tr>
<td>âœ… å†…ç½®é™æµ/ç†”æ–­/ç¼“å­˜</td>
<td>âŒ ç¤¾åŒºæ´»è·ƒåº¦ä¸‹é™</td>
</tr>
<tr>
<td>âœ… æ”¯æŒæœåŠ¡å‘ç°ï¼ˆConsul/Eurekaï¼‰</td>
<td>âŒ æ‰©å±•æ€§æœ‰é™</td>
</tr>
<tr>
<td>âœ… æ–‡æ¡£å®Œå–„</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="azure-api-management">Azure API Management</h4>
<table>
<thead>
<tr>
<th>ä¼˜åŠ¿</th>
<th>åŠ£åŠ¿</th>
</tr>
</thead>
<tbody>
<tr>
<td>âœ… å®Œæ•´çš„ç®¡ç†ç•Œé¢</td>
<td>âŒ æˆæœ¬è¾ƒé«˜</td>
</tr>
<tr>
<td>âœ… å¼€å‘è€…é—¨æˆ·</td>
<td>âŒ ä»…é™ Azure</td>
</tr>
<tr>
<td>âœ… æ‰˜ç®¡æœåŠ¡ï¼Œæ— éœ€è¿ç»´</td>
<td>âŒ å†·å¯åŠ¨å»¶è¿Ÿ</td>
</tr>
<tr>
<td>âœ… å†…ç½®åˆ†æå’Œç›‘æ§</td>
<td>âŒ è‡ªå®šä¹‰å—é™</td>
</tr>
<tr>
<td>âœ… ç‰ˆæœ¬ç®¡ç†ã€API æ–‡æ¡£</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="kong">Kong</h4>
<table>
<thead>
<tr>
<th>ä¼˜åŠ¿</th>
<th>åŠ£åŠ¿</th>
</tr>
</thead>
<tbody>
<tr>
<td>âœ… è¯­è¨€æ— å…³ï¼Œå¤šç¯å¢ƒéƒ¨ç½²</td>
<td>âŒ ä¸æ˜¯ .NET åŸç”Ÿ</td>
</tr>
<tr>
<td>âœ… ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€</td>
<td>âŒ éƒ¨ç½²å¤æ‚ï¼ˆéœ€è¦æ•°æ®åº“ï¼‰</td>
</tr>
<tr>
<td>âœ… ä¼ä¸šç‰ˆåŠŸèƒ½å¼ºå¤§</td>
<td>âŒ ä¼ä¸šç‰ˆæ”¶è´¹</td>
</tr>
<tr>
<td>âœ… ç®¡ç†ç•Œé¢</td>
<td>âŒ ä¸ .NET é›†æˆä¸å¦‚åŸç”Ÿæ–¹æ¡ˆ</td>
</tr>
</tbody>
</table>
<h3 id="é€‰å‹å»ºè®®">4.4 é€‰å‹å»ºè®®</h3>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>æ¨èæ–¹æ¡ˆ</th>
<th>ç†ç”±</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>é«˜æ€§èƒ½éœ€æ±‚</strong></td>
<td>YARP</td>
<td>æ€§èƒ½æœ€ä½³ï¼Œå®˜æ–¹æ”¯æŒ</td>
</tr>
<tr>
<td><strong>å¿«é€Ÿæ­å»º</strong></td>
<td>Ocelot</td>
<td>åŠŸèƒ½å®Œæ•´ï¼Œé…ç½®ç®€å•</td>
</tr>
<tr>
<td><strong>Azure éƒ¨ç½²</strong></td>
<td>Azure APIM</td>
<td>æ‰˜ç®¡æœåŠ¡ï¼Œæ— éœ€è¿ç»´</td>
</tr>
<tr>
<td><strong>å¤šè¯­è¨€å¾®æœåŠ¡</strong></td>
<td>Kong</td>
<td>è¯­è¨€æ— å…³ï¼Œæ’ä»¶ä¸°å¯Œ</td>
</tr>
<tr>
<td><strong>æ·±åº¦å®šåˆ¶</strong></td>
<td>YARP + è‡ªå®šä¹‰æ‰©å±•</td>
<td>å¯æ§æ€§æœ€å¼º</td>
</tr>
<tr>
<td><strong>ä¸­å°å‹é¡¹ç›®</strong></td>
<td>Ocelot</td>
<td>å¤Ÿç”¨ä¸”ç®€å•</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="äº‘éƒ¨ç½²ç½‘å…³è®¾è®¡æ³¨æ„äº‹é¡¹">5. äº‘éƒ¨ç½²ç½‘å…³è®¾è®¡æ³¨æ„äº‹é¡¹</h2>
<h3 id="é«˜å¯ç”¨è®¾è®¡">5.1 é«˜å¯ç”¨è®¾è®¡</h3>
<pre><code>                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Load Balancer  â”‚
                    â”‚   (Azure LB /   â”‚
                    â”‚    AWS ALB)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼                â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Gateway    â”‚ â”‚   Gateway    â”‚ â”‚   Gateway    â”‚
    â”‚  (Zone A)    â”‚ â”‚  (Zone B)    â”‚ â”‚  (Zone C)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š - âœ… å¤šå®ä¾‹éƒ¨ç½²ï¼Œè·¨å¯ç”¨åŒº - âœ…
æ— çŠ¶æ€è®¾è®¡ï¼Œæ”¯æŒæ°´å¹³æ‰©å±• - âœ… å¥åº·æ£€æŸ¥é…ç½® - âœ… ä¼šè¯ä¿æŒï¼ˆå¦‚éœ€è¦ï¼‰</p>
<h3 id="å®‰å…¨è®¾è®¡">5.2 å®‰å…¨è®¾è®¡</h3>
<pre><code class="language-csharp">// 1. HTTPS å¼ºåˆ¶
app.UseHttpsRedirection();
app.UseHsts();

// 2. è¯·æ±‚å¤´å®‰å…¨
app.Use(async (context, next) =&gt;
{
    context.Response.Headers.Add(&quot;X-Content-Type-Options&quot;, &quot;nosniff&quot;);
    context.Response.Headers.Add(&quot;X-Frame-Options&quot;, &quot;DENY&quot;);
    context.Response.Headers.Add(&quot;X-XSS-Protection&quot;, &quot;1; mode=block&quot;);
    await next();
});

// 3. IP ç™½åå•ï¼ˆå†…éƒ¨æœåŠ¡ï¼‰
builder.Services.AddReverseProxy()
    .AddTransforms(context =&gt;
    {
        context.AddRequestTransform(async transformContext =&gt;
        {
            var clientIp = transformContext.HttpContext.Connection.RemoteIpAddress;
            if (!IsAllowedIp(clientIp))
            {
                transformContext.HttpContext.Response.StatusCode = 403;
                return;
            }
        });
    });

// 4. è¯·æ±‚å¤§å°é™åˆ¶
builder.WebHost.ConfigureKestrel(options =&gt;
{
    options.Limits.MaxRequestBodySize = 10 * 1024 * 1024; // 10MB
});</pre>
<h3 id="é™æµä¸ç†”æ–­-1">5.3 é™æµä¸ç†”æ–­</h3>
<pre><code class="language-csharp">// ä½¿ç”¨ ASP.NET Core Rate Limiting (.NET 7+)
builder.Services.AddRateLimiter(options =&gt;
{
    // å…¨å±€é™æµ
    options.GlobalLimiter = PartitionedRateLimiter.Create&lt;HttpContext, string&gt;(context =&gt;
        RateLimitPartition.GetFixedWindowLimiter(
            partitionKey: context.Connection.RemoteIpAddress?.ToString() ?? &quot;unknown&quot;,
            factory: _ =&gt; new FixedWindowRateLimiterOptions
            {
                PermitLimit = 100,
                Window = TimeSpan.FromMinutes(1),
                QueueLimit = 10
            }));
    
    // æŒ‰è·¯ç”±é™æµ
    options.AddPolicy(&quot;api&quot;, context =&gt;
        RateLimitPartition.GetSlidingWindowLimiter(
            partitionKey: context.User.Identity?.Name ?? &quot;anonymous&quot;,
            factory: _ =&gt; new SlidingWindowRateLimiterOptions
            {
                PermitLimit = 1000,
                Window = TimeSpan.FromMinutes(1),
                SegmentsPerWindow = 6
            }));
    
    options.OnRejected = async (context, token) =&gt;
    {
        context.HttpContext.Response.StatusCode = 429;
        await context.HttpContext.Response.WriteAsJsonAsync(new
        {
            error = &quot;Too many requests&quot;,
            retryAfter = context.Lease.TryGetMetadata(MetadataName.RetryAfter, out var retryAfter)
                ? retryAfter.TotalSeconds : 60
        }, token);
    };
});

app.UseRateLimiter();</pre>
<h3 id="å¯è§‚æµ‹æ€§">5.4 å¯è§‚æµ‹æ€§</h3>
<pre><code class="language-csharp">// OpenTelemetry é›†æˆ
builder.Services.AddOpenTelemetry()
    .WithTracing(tracing =&gt;
    {
        tracing
            .AddAspNetCoreInstrumentation()
            .AddHttpClientInstrumentation()
            .AddSource(&quot;Yarp.ReverseProxy&quot;)
            .AddOtlpExporter(options =&gt;
            {
                options.Endpoint = new Uri(&quot;http://otel-collector:4317&quot;);
            });
    })
    .WithMetrics(metrics =&gt;
    {
        metrics
            .AddAspNetCoreInstrumentation()
            .AddHttpClientInstrumentation()
            .AddMeter(&quot;Yarp.ReverseProxy&quot;)
            .AddOtlpExporter();
    });

// å¥åº·æ£€æŸ¥ç«¯ç‚¹
builder.Services.AddHealthChecks()
    .AddCheck(&quot;gateway&quot;, () =&gt; HealthCheckResult.Healthy())
    .AddRedis(redisConnectionString)
    .AddUrlGroup(new Uri(&quot;http://backend/health&quot;), &quot;backend&quot;);

app.MapHealthChecks(&quot;/health&quot;, new HealthCheckOptions
{
    ResponseWriter = UIResponseWriter.WriteHealthCheckUIResponse
});</pre>
<h3 id="é…ç½®ç®¡ç†">5.5 é…ç½®ç®¡ç†</h3>
<pre><code class="language-csharp">// åŠ¨æ€é…ç½®ï¼ˆæ— éœ€é‡å¯ï¼‰
builder.Services.AddReverseProxy()
    .LoadFromConfig(builder.Configuration.GetSection(&quot;ReverseProxy&quot;))
    .ConfigureHttpClient((context, handler) =&gt;
    {
        // è‡ªå®šä¹‰ HttpClient
        handler.SslOptions.RemoteCertificateValidationCallback = 
            (sender, cert, chain, errors) =&gt; true; // ä»…å¼€å‘ç¯å¢ƒ
    });

// ä»é…ç½®ä¸­å¿ƒåŠ è½½ï¼ˆå¦‚ Azure App Configurationï¼‰
builder.Configuration.AddAzureAppConfiguration(options =&gt;
{
    options.Connect(connectionString)
        .Select(&quot;Gateway:*&quot;)
        .ConfigureRefresh(refresh =&gt;
        {
            refresh.Register(&quot;Gateway:Sentinel&quot;, refreshAll: true)
                .SetCacheExpiration(TimeSpan.FromSeconds(30));
        });
});</pre>
<h3 id="å®¹å™¨åŒ–éƒ¨ç½²">5.6 å®¹å™¨åŒ–éƒ¨ç½²</h3>
<p><strong>Dockerfile</strong>:</p>
<pre><code class="language-dockerfile">FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS base
WORKDIR /app
EXPOSE 80
EXPOSE 443

FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src
COPY [&quot;Gateway/Gateway.csproj&quot;, &quot;Gateway/&quot;]
RUN dotnet restore &quot;Gateway/Gateway.csproj&quot;
COPY . .
WORKDIR &quot;/src/Gateway&quot;
RUN dotnet build -c Release -o /app/build

FROM build AS publish
RUN dotnet publish -c Release -o /app/publish

FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s \
  CMD curl -f http://localhost/health || exit 1

ENTRYPOINT [&quot;dotnet&quot;, &quot;Gateway.dll&quot;]</pre>
<p><strong>Kubernetes éƒ¨ç½²</strong>:</p>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-gateway
spec:
  replicas: 3
  selector:
    matchLabels:
      app: api-gateway
  template:
    metadata:
      labels:
        app: api-gateway
    spec:
      containers:
      - name: gateway
        image: myregistry/api-gateway:latest
        ports:
        - containerPort: 80
        resources:
          requests:
            memory: &quot;256Mi&quot;
            cpu: &quot;250m&quot;
          limits:
            memory: &quot;512Mi&quot;
            cpu: &quot;500m&quot;
        livenessProbe:
          httpGet:
            path: /health
            port: 80
          initialDelaySeconds: 10
          periodSeconds: 30
        readinessProbe:
          httpGet:
            path: /health
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 10
        env:
        - name: ASPNETCORE_ENVIRONMENT
          value: &quot;Production&quot;
---
apiVersion: v1
kind: Service
metadata:
  name: api-gateway
spec:
  type: LoadBalancer
  ports:
  - port: 80
    targetPort: 80
  selector:
    app: api-gateway
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: api-gateway-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: api-gateway
  minReplicas: 3
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70</pre>
<h3 id="äº‘éƒ¨ç½²æ£€æŸ¥æ¸…å•">5.7 äº‘éƒ¨ç½²æ£€æŸ¥æ¸…å•</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              äº‘éƒ¨ç½²ç½‘å…³æ£€æŸ¥æ¸…å•                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  é«˜å¯ç”¨                                                 â”‚
â”‚  â–¡ å¤šå®ä¾‹éƒ¨ç½²ï¼ˆè‡³å°‘ 3 ä¸ªï¼‰                              â”‚
â”‚  â–¡ è·¨å¯ç”¨åŒºåˆ†å¸ƒ                                        â”‚
â”‚  â–¡ å¥åº·æ£€æŸ¥é…ç½®                                        â”‚
â”‚  â–¡ è‡ªåŠ¨æ‰©ç¼©å®¹ç­–ç•¥                                      â”‚
â”‚                                                         â”‚
â”‚  å®‰å…¨                                                   â”‚
â”‚  â–¡ HTTPS å¼ºåˆ¶                                          â”‚
â”‚  â–¡ WAF é…ç½®                                            â”‚
â”‚  â–¡ DDoS é˜²æŠ¤                                           â”‚
â”‚  â–¡ è¯·æ±‚å¤§å°é™åˆ¶                                        â”‚
â”‚  â–¡ æ•æ„Ÿä¿¡æ¯è„±æ•                                        â”‚
â”‚                                                         â”‚
â”‚  æ€§èƒ½                                                   â”‚
â”‚  â–¡ é™æµç­–ç•¥                                            â”‚
â”‚  â–¡ ç†”æ–­é™çº§                                            â”‚
â”‚  â–¡ å“åº”ç¼“å­˜                                            â”‚
â”‚  â–¡ è¿æ¥æ± é…ç½®                                          â”‚
â”‚                                                         â”‚
â”‚  å¯è§‚æµ‹                                                 â”‚
â”‚  â–¡ æ—¥å¿—èšåˆ                                            â”‚
â”‚  â–¡ é“¾è·¯è¿½è¸ª                                            â”‚
â”‚  â–¡ æŒ‡æ ‡ç›‘æ§                                            â”‚
â”‚  â–¡ å‘Šè­¦é…ç½®                                            â”‚
â”‚                                                         â”‚
â”‚  è¿ç»´                                                   â”‚
â”‚  â–¡ é…ç½®ä¸­å¿ƒé›†æˆ                                        â”‚
â”‚  â–¡ å¯†é’¥ç®¡ç†ï¼ˆKey Vaultï¼‰                               â”‚
â”‚  â–¡ è“ç»¿/é‡‘ä¸é›€å‘å¸ƒ                                     â”‚
â”‚  â–¡ å›æ»šç­–ç•¥                                            â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre>
<hr />
<h2 id="æ€»ç»“">6. æ€»ç»“</h2>
<h3 id="æ ¸å¿ƒè¦ç‚¹">æ ¸å¿ƒè¦ç‚¹</h3>
<table>
<thead>
<tr>
<th>ä¸»é¢˜</th>
<th>å…³é”®ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>ç½‘å…³ä½œç”¨</strong></td>
<td>ç»Ÿä¸€å…¥å£ã€å®‰å…¨è¾¹ç•Œã€æµé‡ç®¡æ§ã€ç›‘æ§å®¡è®¡</td>
</tr>
<tr>
<td><strong>æ¨èæ–¹æ¡ˆ</strong></td>
<td>é«˜æ€§èƒ½é€‰ YARPï¼Œå¿«é€Ÿæ­å»ºé€‰ Ocelotï¼ŒAzure é€‰ APIM</td>
</tr>
<tr>
<td><strong>äº‘éƒ¨ç½²</strong></td>
<td>å¤šå®ä¾‹ã€è·¨å¯ç”¨åŒºã€é™æµç†”æ–­ã€å¯è§‚æµ‹æ€§</td>
</tr>
<tr>
<td><strong>å®‰å…¨</strong></td>
<td>HTTPSã€WAFã€é™æµã€è¯·æ±‚æ ¡éªŒ</td>
</tr>
</tbody>
</table>
<h3 id="é€‰å‹é€ŸæŸ¥">é€‰å‹é€ŸæŸ¥</h3>
<table>
<thead>
<tr>
<th>éœ€æ±‚</th>
<th>æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ–°é¡¹ç›® + é«˜æ€§èƒ½</td>
<td>YARP</td>
</tr>
<tr>
<td>å¿«é€Ÿæ­å»º + åŠŸèƒ½å®Œæ•´</td>
<td>Ocelot</td>
</tr>
<tr>
<td>Azure äº‘åŸç”Ÿ</td>
<td>Azure API Management</td>
</tr>
<tr>
<td>å¤šè¯­è¨€å¾®æœåŠ¡</td>
<td>Kong</td>
</tr>
</tbody>
</table>
<h3 id="å‚è€ƒèµ„æº">å‚è€ƒèµ„æº</h3>
<ul>
<li><a href="https://microsoft.github.io/reverse-proxy/">YARP
Documentation</a></li>
<li><a href="https://ocelot.readthedocs.io/">Ocelot
Documentation</a></li>
<li><a
href="https://learn.microsoft.com/en-us/azure/api-management/">Azure API
Management</a></li>
<li><a href="https://docs.konghq.com/">Kong Gateway</a></li>
</ul>

                </article>
            </div>
        </section>

        <!-- å³ä¾§çƒ­é—¨æ–‡ç«  -->
        <aside class="popular-sidebar">
            <div class="popular-header">
                <h3>çƒ­é—¨æ–‡ç« </h3>
            </div>
            <div class="popular-list" id="popular-list">
                <!-- åŠ¨æ€ç”Ÿæˆçš„çƒ­é—¨æ–‡ç« åˆ—è¡¨ -->
            </div>
        </aside>
    </main>

    <!-- JavaScript -->
    <script type="module" src="/script.js?v=2.2.0"></script>
    
    <!-- Initialize Highlight.js -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Highlight all code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
        });
    </script>
</body>
</html>